/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0xede6=['switchReadOnly','newRange','openNewCommentThread','upcast','delete','removeMarker','_changedMarkers','get','hasCommentThread','change:isReadOnly','markers','createPositionBefore','state','requires','isCollapsed','once','add','ck-comment-marker--active','addComment','change','schema','editing','for','plugins','size','commands','model','has','update:comment','comment','comment:','markerToElement','hasContent','editingDowncast','createUIElement','ck-comment-marker','set','change:activeMarker','destroy','then','data','_detachCommentThread','stop','collaboration.channelId','isObject','rootName','config','split','CommentsRepository','conversion','getWalker','change:isThreadsLoadingPaused','elementToMarker','low','editor','markerToHighlight','differ','length','updateMarker','listenTo','start','getCommentThread','fetchCommentThread','CommentsEditing','managedUsingOperations','addCommentThread','createRange','document','_threads','destroyed','high','getCommentThreads','isThreadsLoadingPaused','markerName','view','ready','isEqual','push','$graveyard'];(function(_0x3eba80,_0x46eeeb){const _0x5c0d65=function(_0x3989b6){while(--_0x3989b6){_0x3eba80['push'](_0x3eba80['shift']());}};_0x5c0d65(++_0x46eeeb);}(_0xede6,0x120));const _0x572d=function(_0x3eba80,_0x46eeeb){_0x3eba80=_0x3eba80-0x0;let _0x5c0d65=_0xede6[_0x3eba80];return _0x5c0d65;};import _0x28d38b from'@ckeditor/ckeditor5-core/src/plugin';import _0x10ebee from'./commentsrepository';import _0x5cc345 from'./addcommentthreadcommand';import _0x112182 from'../utils/getmarkerdomelement';import _0x314052 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class F extends _0x28d38b{static get[_0x572d('0x29')](){return[_0x10ebee,_0x314052];}static get['pluginName'](){return _0x572d('0xc');}constructor(_0x4216fd){super(_0x4216fd),this[_0x572d('0x40')](_0x572d('0x15'),!0x0),_0x4216fd[_0x572d('0x44')][_0x572d('0x2b')](_0x572d('0x18'),()=>this[_0x572d('0x15')]=!0x1),this['set']('activeMarker',null),this['on'](_0x572d('0x41'),(_0x592575,_0x28f5b7,_0x216ce2,_0x30079f)=>{_0x4216fd[_0x572d('0x36')]['change'](_0x332cf8=>{_0x4216fd[_0x572d('0x36')]['markers'][_0x572d('0x37')](_0x216ce2)&&_0x332cf8[_0x572d('0x7')](_0x216ce2),_0x4216fd[_0x572d('0x36')]['markers'][_0x572d('0x37')](_0x30079f)&&_0x332cf8[_0x572d('0x7')](_0x30079f);});});}['init'](){const _0x21f933=this[_0x572d('0x3')],_0xd84759=_0x21f933['plugins'][_0x572d('0x23')](_0x572d('0x4c')),_0x3533a5=_0x21f933[_0x572d('0x4a')][_0x572d('0x23')]('collaboration.channelId');_0x21f933[_0x572d('0x35')][_0x572d('0x2c')](_0x572d('0xe'),new _0x5cc345(_0x21f933)),this[_0x572d('0x8')](_0x21f933,_0x572d('0x25'),(_0x4d2b0e,_0x3e2ceb,_0x29b9f5)=>{_0xd84759[_0x572d('0x1c')](_0x29b9f5,_0x21f933[_0x572d('0x4a')][_0x572d('0x23')](_0x572d('0x47')));}),this[_0x572d('0x8')](_0xd84759,$('removeCommentThread',_0x3533a5),(_0x28d0b4,{threadId:_0x936dfb})=>{const _0x3d213f=_0x21f933[_0x572d('0x36')][_0x572d('0x26')][_0x572d('0x23')](_0x572d('0x3a')+_0x936dfb),_0x3344cf=_0xd84759[_0x572d('0xa')](_0x936dfb);_0x3d213f&&_0x21f933['model']['change'](_0x143150=>{_0x143150[_0x572d('0x21')](_0x3d213f);}),_0xd84759[_0x572d('0x24')](_0x936dfb)&&!_0x3344cf[_0x572d('0x6')]||_0x28d0b4[_0x572d('0x46')]();},{'priority':_0x572d('0x13')}),this[_0x572d('0x8')](_0xd84759,$(_0x572d('0x2e'),_0x3533a5),(_0x2b2fef,{threadId:_0x5b06d2,isFromAdapter:_0x1e1200})=>{const _0x246666=_0x21f933[_0x572d('0x36')][_0x572d('0x26')][_0x572d('0x23')](_0x572d('0x3a')+_0x5b06d2);!_0x1e1200&&_0x246666&&_0xd84759[_0x572d('0x24')](_0x5b06d2)&&0x1===_0xd84759['getCommentThread'](_0x5b06d2)[_0x572d('0x6')]&&_0x21f933[_0x572d('0x36')][_0x572d('0x2f')](_0x53af25=>{_0x53af25['updateMarker'](_0x246666,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x572d('0x2')}),this['$'](),this['tt']();}[_0x572d('0x42')](){const _0x5b25a8=this[_0x572d('0x3')][_0x572d('0x33')][_0x572d('0x23')](_0x572d('0x4c')),_0x2299ac=this[_0x572d('0x3')][_0x572d('0x4a')][_0x572d('0x23')](_0x572d('0x47'));for(const _0x471c47 of _0x5b25a8[_0x572d('0x14')]({'channelId':_0x2299ac}))_0x5b25a8[_0x572d('0x45')](_0x471c47['id']),_0x5b25a8[_0x572d('0x11')][_0x572d('0x20')](_0x471c47['id']);super[_0x572d('0x42')]();}['$'](){const _0x5a120c=this[_0x572d('0x3')];_0x5a120c['conversion'][_0x572d('0x32')](_0x572d('0x3d'))[_0x572d('0x4')]({'model':_0x572d('0x39'),'view':_0x2d78f1=>{const {id:_0x433c00}=Q(_0x2d78f1[_0x572d('0x16')]),_0x3ec291=[_0x572d('0x3f')];return this['activeMarker']===_0x2d78f1[_0x572d('0x16')]&&_0x3ec291[_0x572d('0x1a')](_0x572d('0x2d')),{'classes':_0x3ec291,'attributes':{'data-comment':_0x433c00}};}}),_0x5a120c['conversion']['for']('dataDowncast')[_0x572d('0x3b')]({'model':_0x572d('0x39'),'view':(_0x63891f,_0x229502)=>{const _0x52a730=_0x5a120c[_0x572d('0x36')][_0x572d('0x26')][_0x572d('0x23')](_0x63891f['markerName']),_0x23ba6f=Q(_0x63891f[_0x572d('0x16')])['id'];if(_0x52a730['affectsData'])return _0x229502[_0x572d('0x3e')](_0x572d('0x39'),{'id':_0x23ba6f,'type':_0x63891f['isOpening']?'start':'end'});}}),_0x5a120c[_0x572d('0x4d')][_0x572d('0x32')](_0x572d('0x1f'))[_0x572d('0x1')]({'view':{'name':_0x572d('0x39'),'attribute':{'id':/^\w/}},'model':_0x3844f0=>'comment:'+_0x3844f0['getAttribute']('id')});}['tt'](){const _0x18364f=this[_0x572d('0x3')],_0x482777=_0x18364f[_0x572d('0x33')][_0x572d('0x23')]('CommentsRepository'),_0x549fc6=new Set(),_0x38ab55=new Set();_0x18364f[_0x572d('0x36')][_0x572d('0x10')]['registerPostFixer'](_0x6ff429=>{let _0x65aba2=!0x1;for(const [_0x54ea95,_0x531560]of _0x18364f[_0x572d('0x36')][_0x572d('0x10')][_0x572d('0x5')][_0x572d('0x22')]){const {group:_0x24089a,id:_0x368197}=Q(_0x54ea95);let _0x4c504d=_0x531560[_0x572d('0x1d')];if(_0x572d('0x39')!==_0x24089a||!_0x4c504d)continue;const _0x3b7946=_0x38ab55['has'](_0x368197),_0x1e67e9=_0x572d('0x1b')===_0x4c504d['root'][_0x572d('0x49')];_0x1e67e9||(_0x4c504d=U(_0x4c504d,_0x18364f[_0x572d('0x36')]),!_0x4c504d||_0x4c504d[_0x572d('0x19')](_0x531560[_0x572d('0x1d')]))?_0x4c504d&&(!_0x3b7946||!_0x1e67e9&&_0x18364f[_0x572d('0x36')][_0x572d('0x3c')](_0x4c504d))?_0x3b7946||_0x1e67e9||(_0x38ab55[_0x572d('0x2c')](_0x368197),this[_0x572d('0x15')]?_0x549fc6[_0x572d('0x2c')](_0x54ea95):this['et'](_0x54ea95)):(_0x6ff429['removeMarker'](_0x54ea95),_0x65aba2=!0x0):(_0x6ff429[_0x572d('0x7')](_0x54ea95,{'range':_0x4c504d}),_0x65aba2=!0x0);}return _0x65aba2;}),this['on'](_0x572d('0x0'),(_0x3c0cd3,_0xd7266e,_0x24f53b)=>{if(!_0x24f53b&&_0x549fc6[_0x572d('0x34')])for(const _0x4ab128 of _0x549fc6)this['et'](_0x4ab128),_0x549fc6[_0x572d('0x20')](_0x4ab128);}),this[_0x572d('0x8')](_0x18364f[_0x572d('0x36')]['markers'],_0x572d('0x38'),(_0x5cfaa8,_0x10d500,_0x89c3e5,_0x50a7c9)=>{if(_0x50a7c9)return;const {id:_0xd4d415}=Q(_0x10d500['name']),_0x2e6345=_0x18364f[_0x572d('0x33')][_0x572d('0x23')](_0x572d('0x4c'))[_0x572d('0xa')](_0xd4d415);_0x38ab55[_0x572d('0x20')](_0xd4d415),_0x549fc6['delete'](_0x10d500['name']),_0x2e6345&&_0x482777[_0x572d('0x45')](_0xd4d415);});}['et'](_0x158503){const _0x21339e=this['editor'],_0x45528f=_0x21339e[_0x572d('0x33')][_0x572d('0x23')](_0x572d('0x4c')),_0xf89c44=_0x21339e[_0x572d('0x4a')][_0x572d('0x23')]('collaboration.channelId'),_0x527f96=_0x21339e['model']['markers'][_0x572d('0x23')](_0x158503),{id:_0x16a801}=Q(_0x158503);_0x527f96[_0x572d('0xd')]?_0x45528f[_0x572d('0xb')]({'channelId':_0xf89c44,'threadId':_0x16a801})[_0x572d('0x43')](_0x379682=>{_0x572d('0x12')!==_0x21339e[_0x572d('0x28')]&&(_0x379682?_0x379682['attachTo'](()=>_0x112182(_0x21339e[_0x572d('0x31')],_0x527f96)):_0x21339e[_0x572d('0x36')]['change'](_0x10e1ff=>{_0x10e1ff[_0x572d('0x21')](_0x527f96);}));}):_0x21339e['editing'][_0x572d('0x17')]['once']('render',()=>{_0x45528f[_0x572d('0x1e')]({'channelId':_0xf89c44,'threadId':_0x16a801,'target':()=>_0x112182(_0x21339e[_0x572d('0x31')],_0x527f96)});},{'priority':_0x572d('0x2')});}}function $(_0x21e85d,_0x368c0d){return _0x368c0d?_0x21e85d+':'+_0x368c0d:_0x21e85d;}function Q(_0x35cac7){const _0x3bf654=_0x35cac7[_0x572d('0x4b')](':');return{'group':_0x3bf654[0x0],'id':_0x3bf654[0x1]};}function U(_0x3a70a1,_0x47eeee){const _0xea5d15=_0x47eeee[_0x572d('0x30')],_0xe0d1f1=_0x47eeee[_0x572d('0xf')](_0x3a70a1[_0x572d('0x9')]);for(const _0x1d0532 of _0x3a70a1[_0x572d('0x4e')]()){const {type:_0x578ca9,item:_0x4eef8,nextPosition:_0x32b47f}=_0x1d0532;if('text'===_0x578ca9||_0xea5d15[_0x572d('0x48')](_0x4eef8)){const _0x597762=_0x47eeee[_0x572d('0x27')](_0x4eef8);_0xe0d1f1[_0x572d('0x2a')]&&(_0xe0d1f1[_0x572d('0x9')]=_0x597762),_0xe0d1f1['end']=_0x32b47f;}}return _0xe0d1f1[_0x572d('0x2a')]?null:_0xe0d1f1;}