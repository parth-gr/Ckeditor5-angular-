/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x5f12d3 from'@ckeditor/ckeditor5-core/src/plugin';import _0x4068be from'../annotations/annotations';import _0x5632a8 from'./commentsrepository';import _0x28ca6d from'./commentsediting';import _0x221505 from'../annotations/editorannotations';import _0x3bff84 from'@ckeditor/ckeditor5-ui/src/button/buttonview';import _0x2e90b3 from'../../theme/icons/add-comment.svg';export default class G extends _0x5f12d3{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x4068be,_0x5632a8,_0x28ca6d,_0x221505];}['init'](){const _0x2c599d=this['editor'],_0x4b7a9f=_0x2c599d['model'],_0x14ad37=_0x2c599d['plugins']['get']('CommentsRepository'),_0x403efd=_0x2c599d['plugins']['get']('CommentsEditing'),_0x537c12=_0x2c599d['plugins']['get']('Annotations'),_0x5582db=_0x2c599d['plugins']['get']('EditorAnnotations');_0x2c599d['ui']['componentFactory']['add']('comment',()=>this['ut']()),_0x5582db['addSourceCollector'](()=>{const _0x1fca4a=[];for(const [_0x392094,_0x21f45a]of _0x14ad37['_threadToController']){const _0x1847aa=_0x4b7a9f['markers']['get']('comment:'+_0x392094['id']);_0x1847aa&&_0x1fca4a['push']([_0x21f45a['view'],[_0x1847aa['getRange']()]]);}return _0x1fca4a;}),this['listenTo'](_0x537c12,'change:activeView',(_0x463ec2,_0x55364a,_0x553943)=>{if(!_0x14ad37['_viewToController']['has'](_0x553943))return void(_0x403efd['activeMarker']=null);const _0x5b1f19='comment:'+_0x14ad37['_viewToController']['get'](_0x553943)['model']['id'];_0x4b7a9f['markers']['has'](_0x5b1f19)&&_0x403efd['activeMarker']!=_0x5b1f19?_0x403efd['activeMarker']=_0x5b1f19:_0x403efd['activeMarker']&&(_0x403efd['activeMarker']=null);}),this['listenTo'](_0x14ad37,'removeCommentThread',(_0x392158,{threadId:_0x323c13,isFromAdapter:_0x2e7000})=>{if(_0x2e7000||!_0x2c599d['ui']['focusTracker']['isFocused'])return;_0x2c599d['model']['markers']['get']('comment:'+_0x323c13)&&_0x2c599d['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x14ad37,'addComment',(_0x19f4e1,{threadId:_0x5d4d8e,isFromAdapter:_0x2c9b98})=>{const _0x210be3=_0x4b7a9f['markers']['get']('comment:'+_0x5d4d8e);!_0x2c9b98&&_0x210be3&&_0x14ad37['hasCommentThread'](_0x5d4d8e)&&0x1===_0x14ad37['getCommentThread'](_0x5d4d8e)['length']&&(_0x2c599d['editing']['view']['focus'](),_0x19f4e1['stop']());},{'priority':'low'});}['ut'](){const _0x2e99aa=this['editor'],_0x10b3f6=new _0x3bff84(_0x2e99aa['locale']),_0x27d9ea=_0x2e99aa['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x10b3f6['label']=t('Comment'),_0x10b3f6['tooltip']=t('Comment'),_0x10b3f6['icon']=_0x2e90b3,_0x10b3f6['bind']('isEnabled')['to'](_0x27d9ea),this['listenTo'](_0x10b3f6,'execute',()=>_0x27d9ea['execute']()),_0x10b3f6;}}