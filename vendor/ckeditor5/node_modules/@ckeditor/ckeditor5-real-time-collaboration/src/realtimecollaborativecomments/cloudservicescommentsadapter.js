/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x13f8=['remove','destroy','mySessionId','context','comments','commentId','hasCommentThread','init','getCommentThreads','keys','adapter','from','collaboration.channelId','commentThreadId','delete','commentThreadRemoved','register','removeComment','removeCommentThread','unregister','404','getCommentThread','getComment','listenTo','_getService','setUpService','get','getUser','connect','terminateService','cloudservicescommentsadapter-disconnect-not-exist:\x20Missing\x20service\x20of\x20a\x20given\x20channelId','cloudservicescommentsadapter-connect-already-connected:\x20Cannot\x20connect\x20to\x20the\x20same\x20channelId\x20more\x20than\x20once.','assign','commentUpdated','requires','updateComment','cloudservicescommentsadapter-service-not-exist:\x20Missing\x20service\x20of\x20a\x20given\x20channelId','off','code','has','createdAt','addComment','CommentsService','reader','addUser','map','_services','switchReadOnly','content','add','config','reconnect','update','role','all','addCommentThread','getConnectedSessions','catch','plugins'];(function(_0x45ae5d,_0x2db533){const _0xe84cfb=function(_0x336cdf){while(--_0x336cdf){_0x45ae5d['push'](_0x45ae5d['shift']());}};_0xe84cfb(++_0x2db533);}(_0x13f8,0x116));const _0x5895=function(_0x45ae5d,_0x2db533){_0x45ae5d=_0x45ae5d-0x0;let _0xe84cfb=_0x13f8[_0x45ae5d];return _0xe84cfb;};import _0x4f3655 from'@ckeditor/ckeditor5-core/src/context';import _0x5d5805 from'@ckeditor/ckeditor5-core/src/contextplugin';import _0x123e77 from'../../../ckeditor-cloud-services-collaboration/src/comments-v2/commentsservice';import _0x41b843 from'../realtimecollaborativeediting/websocketgateway';import _0x2c94f3 from'../realtimecollaborativeediting/sessions';import _0x45f1a6 from'@ckeditor/ckeditor5-comments/src/comments/commentsrepository';import _0x55d2ae from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x55d47b from'@ckeditor/ckeditor5-collaboration-core/src/users';import _0x5ac39d from'@ckeditor/ckeditor5-utils/src/ckeditorerror';export default class y extends _0x5d5805{static get[_0x5895('0x33')](){return[_0x41b843,_0x45f1a6,_0x2c94f3,_0x55d47b];}constructor(_0x2b45e9){super(_0x2b45e9),this[_0x5895('0x4')]=new Map();}async[_0x5895('0x18')](){const _0xcef336=this['context'],_0x15990a=_0xcef336[_0x5895('0x10')][_0x5895('0x2b')](_0x45f1a6);if(_0xcef336['plugins'][_0x5895('0x2b')](_0x41b843)['addToReconnectionStack'](this),_0x15990a[_0x5895('0x1b')]={'getCommentThread':async({channelId:_0x42d466,threadId:_0x432430})=>{const _0x43d04e=await this[_0x5895('0x29')](_0x42d466)[_0x5895('0x26')](_0x432430);return await this['m']([_0x43d04e]),{'threadId':_0x43d04e[_0x5895('0x1e')],'comments':_0x43d04e[_0x5895('0x15')][_0x5895('0x3')](j)};},'removeCommentThread':({channelId:_0x4c24e0,threadId:_0x2180a4})=>this['_getService'](_0x4c24e0)[_0x5895('0x23')](_0x2180a4)['catch'](U),'addComment':({channelId:_0x459f30,threadId:_0x3a59dc,commentId:_0x67fee6,content:_0x5a6956})=>this[_0x5895('0x29')](_0x459f30)['addComment'](_0x3a59dc,_0x67fee6,_0x5a6956),'updateComment':({channelId:_0x1d5ccc,threadId:_0x1708f3,commentId:_0x166473,content:_0x4c5423})=>this[_0x5895('0x29')](_0x1d5ccc)[_0x5895('0x34')](_0x1708f3,_0x166473,_0x4c5423)[_0x5895('0xf')](U),'removeComment':({channelId:_0x18e511,threadId:_0x20d4d7,commentId:_0x1df971})=>this[_0x5895('0x29')](_0x18e511)[_0x5895('0x22')](_0x20d4d7,_0x1df971)[_0x5895('0xf')](U)},_0xcef336 instanceof _0x4f3655){const _0x1566e6=_0xcef336[_0x5895('0x8')][_0x5895('0x2b')](_0x5895('0x1d')),_0x4db66d=_0xcef336['plugins']['get'](_0x2c94f3);await this[_0x5895('0x2a')](_0x1566e6);const _0x176a0f=await this[_0x5895('0x4')][_0x5895('0x2b')](_0x1566e6)[_0x5895('0xe')]();this[_0x5895('0x28')](_0x4db66d,'sessionAdd:'+_0x1566e6,(_0xbc315e,{session:_0x8d594})=>{_0x8d594['id']===_0x4db66d[_0x5895('0x13')]&&(_0xbc315e[_0x5895('0x36')](),_0x5895('0x1')===_0x8d594[_0x5895('0xb')]&&_0x15990a[_0x5895('0x5')](!0x0,_0x1566e6));}),_0x4db66d[_0x5895('0x21')](_0x1566e6,_0x176a0f);}}async[_0x5895('0x2a')](_0x408d96){if(this[_0x5895('0x4')][_0x5895('0x38')](_0x408d96))throw new _0x5ac39d(_0x5895('0x30'),null,{'channelId':_0x408d96});const _0x414d9d=this[_0x5895('0x14')][_0x5895('0x10')][_0x5895('0x2b')](_0x45f1a6),_0x345acd=new y[(_0x5895('0x0'))](_0x408d96);this[_0x5895('0x4')]['set'](_0x408d96,_0x345acd),this[_0x5895('0x28')](_0x345acd,_0x5895('0x20'),(_0x47724d,{commentThreadId:_0xc5cd55})=>{const _0x22a822=_0x414d9d['getCommentThread'](_0xc5cd55);_0x22a822&&_0x22a822[_0x5895('0x11')]({'isFromAdapter':!0x0});}),this[_0x5895('0x28')](_0x345acd,'commentAdded',(_0x92347a,_0x10de1f)=>{const _0x5eae35=_0x10de1f[_0x5895('0x1e')];_0x414d9d[_0x5895('0x17')](_0x5eae35)||_0x414d9d[_0x5895('0xd')]({'channelId':_0x408d96,'threadId':_0x5eae35,'isFromAdapter':!0x0});const _0x27f902=_0x414d9d[_0x5895('0x26')](_0x5eae35);_0x27f902&&_0x27f902[_0x5895('0x3a')](Object[_0x5895('0x31')](j(_0x10de1f),{'isFromAdapter':!0x0}));}),this[_0x5895('0x28')](_0x345acd,_0x5895('0x32'),(_0x5aee8b,{commentThreadId:_0xe86938,commentId:_0x1f1bb9,content:_0x22327a})=>{const _0x46babd=_0x414d9d[_0x5895('0x26')](_0xe86938);if(_0x46babd){const _0x46294f=_0x46babd[_0x5895('0x27')](_0x1f1bb9);_0x46294f&&_0x46294f[_0x5895('0xa')]({'content':_0x22327a,'isFromAdapter':!0x0});}}),this[_0x5895('0x28')](_0x345acd,'commentRemoved',(_0x52b402,{commentThreadId:_0x191ac9,commentId:_0x457588})=>{const _0x5cad84=_0x414d9d[_0x5895('0x26')](_0x191ac9);if(_0x5cad84){const _0x6b2096=_0x5cad84[_0x5895('0x27')](_0x457588);_0x6b2096&&_0x6b2096[_0x5895('0x11')]({'isFromAdapter':!0x0});}}),await this['l'](_0x408d96);}[_0x5895('0x12')](){if(this[_0x5895('0x14')]instanceof _0x4f3655){const _0x47fd18=this['context'][_0x5895('0x8')][_0x5895('0x2b')]('collaboration.channelId');this['terminateService'](_0x47fd18);}}[_0x5895('0x2e')](_0x2f462e){if(!this[_0x5895('0x4')]['has'](_0x2f462e))throw new _0x5ac39d(_0x5895('0x2f'),null,{'channelId':_0x2f462e});this[_0x5895('0x29')](_0x2f462e)['disconnect'](),this[_0x5895('0x4')][_0x5895('0x1f')](_0x2f462e);}async[_0x5895('0x9')](){for(const _0x3bcbde of this[_0x5895('0x4')][_0x5895('0x1a')]())await this['l'](_0x3bcbde);if(this['context']instanceof _0x4f3655){const _0x5d763a=this[_0x5895('0x14')][_0x5895('0x8')][_0x5895('0x2b')](_0x5895('0x1d')),_0x9c010=this[_0x5895('0x14')][_0x5895('0x10')]['get'](_0x2c94f3);_0x9c010[_0x5895('0x24')](_0x5d763a);const _0x360fd9=await this['_services'][_0x5895('0x2b')](_0x5d763a)['getConnectedSessions']();_0x9c010[_0x5895('0x21')](_0x5d763a,_0x360fd9);}}async['l'](_0x4a14ee){const {connection:_0x3ba8e3}=this['context'][_0x5895('0x10')][_0x5895('0x2b')](_0x41b843),_0x27a9e7=this[_0x5895('0x14')][_0x5895('0x10')][_0x5895('0x2b')](_0x45f1a6),_0x5bfeba=this[_0x5895('0x4')][_0x5895('0x2b')](_0x4a14ee),_0x4433bc=await _0x5bfeba[_0x5895('0x2d')](_0x3ba8e3);await this['m'](_0x4433bc);const _0x4f7dcc=new Set(Array['from'](_0x27a9e7[_0x5895('0x19')]({'channelId':_0x4a14ee}),_0x4dab5d=>_0x4dab5d['id']));for(const _0x2ef4e0 of _0x4433bc)_0x4f7dcc['delete'](_0x2ef4e0['commentThreadId']);for(const _0x264224 of _0x4f7dcc)_0x27a9e7['getCommentThread'](_0x264224)[_0x5895('0x11')]({'isFromAdapter':!0x0});for(const _0x1d80d7 of _0x4433bc){let _0x3cc692=_0x27a9e7['getCommentThread'](_0x1d80d7[_0x5895('0x1e')]);_0x3cc692||(_0x3cc692=_0x27a9e7['addCommentThread']({'channelId':_0x4a14ee,'threadId':_0x1d80d7[_0x5895('0x1e')],'isFromAdapter':!0x0}));const _0x3b2f8f=new Set(Array[_0x5895('0x1c')](_0x3cc692[_0x5895('0x15')],_0x4b1e01=>_0x4b1e01['id']));for(const _0x4fef49 of _0x1d80d7['comments'])_0x3b2f8f[_0x5895('0x1f')](_0x4fef49[_0x5895('0x16')]);for(const _0x45bbd2 of _0x3b2f8f)_0x3cc692[_0x5895('0x27')](_0x45bbd2)[_0x5895('0x11')]({'isFromAdapter':!0x0});for(const _0x2dc618 of _0x1d80d7[_0x5895('0x15')]){const _0x4ef872=_0x3cc692['getComment'](_0x2dc618[_0x5895('0x16')]);_0x4ef872?_0x4ef872[_0x5895('0x6')]!==_0x2dc618['content']&&_0x4ef872[_0x5895('0xa')]({'content':_0x2dc618[_0x5895('0x6')],'isFromAdapter':!0x0}):_0x3cc692[_0x5895('0x3a')](Object['assign'](j(_0x2dc618),{'isFromAdapter':!0x0}));}}}[_0x5895('0x29')](_0x247e16){if(!this[_0x5895('0x4')][_0x5895('0x38')](_0x247e16))throw new _0x5ac39d(_0x5895('0x35'),null,{'channelId':_0x247e16});return this[_0x5895('0x4')][_0x5895('0x2b')](_0x247e16);}['m'](_0x22f7eb){const _0x9ac1a9=this[_0x5895('0x14')][_0x5895('0x10')][_0x5895('0x2b')](_0x55d47b),{connection:_0x134490}=this[_0x5895('0x14')][_0x5895('0x10')][_0x5895('0x2b')](_0x41b843),_0x4831a5=new Set();for(const {comments:_0x344038}of _0x22f7eb)for(const {userId:_0x78c2d1}of _0x344038)_0x9ac1a9[_0x5895('0x2c')](_0x78c2d1)||_0x4831a5[_0x5895('0x7')](_0x78c2d1);return Promise[_0x5895('0xc')](Array[_0x5895('0x1c')](_0x4831a5,async _0x514cf8=>{const _0x1a8332=await _0x55d2ae[_0x5895('0x2b')](_0x134490,_0x514cf8);_0x9ac1a9[_0x5895('0x2c')](_0x514cf8)||_0x9ac1a9[_0x5895('0x2')](_0x1a8332);}));}}async function U(_0x5ed2dc){if(_0x5895('0x25')!==_0x5ed2dc[_0x5895('0x37')])throw _0x5ed2dc;}function j(_0x2e2ff6){return{'threadId':_0x2e2ff6[_0x5895('0x1e')],'commentId':_0x2e2ff6[_0x5895('0x16')],'content':_0x2e2ff6[_0x5895('0x6')],'createdAt':_0x2e2ff6[_0x5895('0x39')],'authorId':_0x2e2ff6['userId']};}y[_0x5895('0x0')]=_0x123e77;