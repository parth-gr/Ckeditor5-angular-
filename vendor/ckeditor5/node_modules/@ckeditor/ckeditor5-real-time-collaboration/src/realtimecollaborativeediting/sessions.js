/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x468c=['has','sessionId','set','clear','connected','sessions-register-already-registered:\x20Sessions\x20of\x20given\x20channelId\x20already\x20registered.','forEach','channelConnectedUsers','get','sessions-unregister-not-exist:\x20Cannot\x20unregister\x20not\x20registered\x20sessions.','unregister','user','change:state','defineMe','getUser','getUserSessions','remove','orderNumber','add','channelSessions','getUserBySessionId','delete','connection','Sessions','values','plugins','state','pluginName','context','mySessionId','init','fire','allConnectedUsers','listenTo','size','getUserRole'];(function(_0x4e6019,_0x13e32e){const _0x235cfa=function(_0x54e875){while(--_0x54e875){_0x4e6019['push'](_0x4e6019['shift']());}};_0x235cfa(++_0x13e32e);}(_0x468c,0xfa));const _0x4f4e=function(_0x4e6019,_0x13e32e){_0x4e6019=_0x4e6019-0x0;let _0x235cfa=_0x468c[_0x4e6019];return _0x235cfa;};import _0x349e23 from'@ckeditor/ckeditor5-core/src/contextplugin';import _0x8456ca from'@ckeditor/ckeditor5-utils/src/collection';import _0x55cde5 from'./websocketgateway';import _0x157fe1 from'@ckeditor/ckeditor5-collaboration-core/src/users';import _0x2c4423 from'@ckeditor/ckeditor5-utils/src/ckeditorerror';export default class r extends _0x349e23{static get[_0x4f4e('0x1d')](){return _0x4f4e('0x19');}static get['requires'](){return[_0x55cde5,_0x157fe1];}[_0x4f4e('0x20')](){const _0x9ba133=this[_0x4f4e('0x1e')],_0xf1dd89=_0x9ba133[_0x4f4e('0x1b')][_0x4f4e('0xa')](_0x55cde5);this['channelSessions']=new Map(),this[_0x4f4e('0x9')]=new Map(),this[_0x4f4e('0x22')]=new _0x8456ca(),this['J']=new Map(),this['K']=0x0,this['L']=_0x9ba133[_0x4f4e('0x1b')][_0x4f4e('0xa')](_0x157fe1),this[_0x4f4e('0x23')](_0xf1dd89,_0x4f4e('0xe'),(_0x12e4b8,_0x1b41c2,_0x253f59)=>{if('connected'!==_0x253f59)this[_0x4f4e('0x15')][_0x4f4e('0x8')](_0x1a88ce=>_0x1a88ce[_0x4f4e('0x5')]()),this[_0x4f4e('0x9')][_0x4f4e('0x8')](_0x3e0dff=>_0x3e0dff[_0x4f4e('0x5')]()),this['allConnectedUsers']['clear']();else for(const [_0x5839f5,_0x3f8090]of this['J'])for(const _0x117b90 of _0x3f8090)this['X'](_0x5839f5,_0x117b90);}),this['Y'](_0xf1dd89['connection']['me'],!0x0);}['register'](_0x514c0e,_0x307975){if(this['J'][_0x4f4e('0x2')](_0x514c0e))throw new _0x2c4423(_0x4f4e('0x7'),null,{'channelId':_0x514c0e});this['J'][_0x4f4e('0x4')](_0x514c0e,_0x307975),this[_0x4f4e('0x15')][_0x4f4e('0x4')](_0x514c0e,new _0x8456ca()),this[_0x4f4e('0x9')][_0x4f4e('0x4')](_0x514c0e,new _0x8456ca()),this[_0x4f4e('0x23')](_0x307975,_0x4f4e('0x14'),(_0x4ddc1b,_0x52274b)=>this['X'](_0x514c0e,_0x52274b)),this['listenTo'](_0x307975,'remove',(_0x138c3c,_0x578922)=>this['Z'](_0x514c0e,_0x578922));for(const _0x4e7049 of _0x307975)this['X'](_0x514c0e,_0x4e7049);}[_0x4f4e('0xc')](_0x1c59e7){if(!this['J'][_0x4f4e('0x2')](_0x1c59e7))throw new _0x2c4423(_0x4f4e('0xb'),null,{'channelId':_0x1c59e7});const _0x34b994=this['J'][_0x4f4e('0xa')](_0x1c59e7);this['stopListening'](_0x34b994);for(const _0x29faf6 of _0x34b994)_0x4f4e('0x6')===this[_0x4f4e('0x1e')]['plugins'][_0x4f4e('0xa')](_0x55cde5)[_0x4f4e('0x1c')]&&this['Z'](_0x1c59e7,_0x29faf6);this['J'][_0x4f4e('0x17')](_0x1c59e7),this[_0x4f4e('0x15')][_0x4f4e('0x17')](_0x1c59e7),this[_0x4f4e('0x9')]['delete'](_0x1c59e7);}get[_0x4f4e('0x1f')](){return this['context'][_0x4f4e('0x1b')]['get'](_0x55cde5)[_0x4f4e('0x18')][_0x4f4e('0x3')];}[_0x4f4e('0x16')](_0x3614e9){for(const _0x2e8a44 of this[_0x4f4e('0x15')][_0x4f4e('0x1a')]())for(const _0x540fa2 of _0x2e8a44)if(_0x540fa2['id']===_0x3614e9)return _0x540fa2[_0x4f4e('0xd')];}['getUserSessions'](_0x6eae69,_0x3d24db){const _0x4413a1=_0x3d24db?[this[_0x4f4e('0x15')][_0x4f4e('0xa')](_0x3d24db)]:this[_0x4f4e('0x15')][_0x4f4e('0x1a')](),_0x142139=new Set();for(const _0x50ac15 of _0x4413a1)for(const _0x955b91 of _0x50ac15)_0x955b91[_0x4f4e('0xd')]['id']===_0x6eae69['id']&&_0x142139[_0x4f4e('0x14')](_0x955b91['id']);return _0x142139;}[_0x4f4e('0x1')](_0x58802e){for(const _0x1a6090 of this['channelSessions'][_0x4f4e('0x1a')]())for(const _0x562025 of _0x1a6090)if(_0x562025[_0x4f4e('0xd')]===_0x58802e)return _0x562025['role'];}['X'](_0x237c8d,_0x41ac2e){if(_0x4f4e('0x6')!==this[_0x4f4e('0x1e')]['plugins'][_0x4f4e('0xa')](_0x55cde5)[_0x4f4e('0x1c')])return;const _0x19d1a4=_0x41ac2e[_0x4f4e('0xd')],_0x31bd14=this['L'][_0x4f4e('0x10')](_0x19d1a4['id'])||this['Y'](_0x19d1a4),_0x2e9017=Object['assign']({},_0x41ac2e,{'user':_0x31bd14});this[_0x4f4e('0x15')]['get'](_0x237c8d)['add'](_0x2e9017);const _0x21057b=this[_0x4f4e('0x9')][_0x4f4e('0xa')](_0x237c8d);_0x21057b[_0x4f4e('0x2')](_0x31bd14['id'])||_0x21057b[_0x4f4e('0x14')](_0x31bd14),this[_0x4f4e('0x22')]['has'](_0x31bd14['id'])||this[_0x4f4e('0x22')][_0x4f4e('0x14')](_0x31bd14),this[_0x4f4e('0x21')]('sessionAdd:'+_0x237c8d,{'channelId':_0x237c8d,'session':_0x2e9017});}['Z'](_0x2cb263,_0x477350){if('connected'!==this[_0x4f4e('0x1e')][_0x4f4e('0x1b')][_0x4f4e('0xa')](_0x55cde5)['state'])return;const _0x516e18=this[_0x4f4e('0x9')][_0x4f4e('0xa')](_0x2cb263),_0x421907=_0x477350[_0x4f4e('0xd')];this[_0x4f4e('0x15')][_0x4f4e('0xa')](_0x2cb263)[_0x4f4e('0x12')](_0x477350['id']),_0x516e18[_0x4f4e('0x2')](_0x421907['id'])&&!this['getUserSessions'](_0x421907,_0x2cb263)[_0x4f4e('0x0')]&&_0x516e18[_0x4f4e('0x12')](_0x421907['id']),this[_0x4f4e('0x22')][_0x4f4e('0xa')](_0x421907['id'])&&!this[_0x4f4e('0x11')](_0x421907)[_0x4f4e('0x0')]&&this[_0x4f4e('0x22')][_0x4f4e('0x12')](_0x421907['id']);}['Y'](_0x3b83d1,_0x38b81d){const _0x263865=this['L']['addUser'](_0x3b83d1);return _0x38b81d&&this['L'][_0x4f4e('0xf')](_0x3b83d1['id']),_0x263865[_0x4f4e('0x13')]=this['K']++,_0x263865;}}