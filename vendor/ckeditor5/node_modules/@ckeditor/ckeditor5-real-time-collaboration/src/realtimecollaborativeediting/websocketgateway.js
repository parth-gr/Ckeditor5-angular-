/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3d77=['offline','reconnect','connection','get','plugins','error','WebSocketGateway','_isBrowserOffline','create','real-time-collaboration','pluginName','connect','initialReconnectionInterval','log','add','webSocketUrl','all','context','delete','Connected\x20users\x20limit\x20exceeded','destroy','has','cloudservices-init:\x20WebSocketGateway\x20connection\x20error.','listenTo','change:me','connected','catch','token','disconnect','set','isInReconnectionStack','websocketgateway-missing-token:\x20The\x20authentication\x20`cloudServices.tokenUrl`\x20configuration\x20is\x20required\x20for\x20creating\x20a\x20websocket\x20connection.','online','state','from','addToReconnectionStack','init','function','The\x20limit\x20of\x20maximum\x20concurrent\x20connections\x20that\x20the\x20collaboration\x20server\x20can\x20handle\x20has\x20been\x20reached.\x20Try\x20opening\x20the\x20document\x20again\x20in\x20a\x20few\x20minutes.\x20Please\x20contact\x20your\x20system\x20administrator\x20if\x20the\x20problem\x20persists.','websocketgateway-missing-websocket-url:\x20The\x20`cloudServices.webSocketUrl`\x20configuration\x20is\x20required\x20for\x20creating\x20a\x20websocket\x20connection\x20in\x20the\x20real-time\x20collaboration.','Retrying\x20websocket\x20connection...','websocketgateway-plugin-already-registered:\x20Plugin\x20is\x20already\x20registered.','disconnected'];(function(_0xc3565f,_0x577909){const _0x32817a=function(_0x519586){while(--_0x519586){_0xc3565f['push'](_0xc3565f['shift']());}};_0x32817a(++_0x577909);}(_0x3d77,0x9c));const _0x3a63=function(_0xc3565f,_0x577909){_0xc3565f=_0xc3565f-0x0;let _0x32817a=_0x3d77[_0xc3565f];return _0x32817a;};import _0x98924b from'@ckeditor/ckeditor5-core/src/contextplugin';import _0x2da1a6 from'@ckeditor/ckeditor5-utils/src/dom/emittermixin';import _0x128779 from'@ckeditor/ckeditor5-utils/src/ckeditorerror';import _0x1b4fbf from'@ckeditor/ckeditor-cloud-services-collaboration/src/websocketgateway/websocketgateway';import _0x1c888f from'@ckeditor/ckeditor5-cloud-services/src/cloudservices';import _0x1520dc from'@ckeditor/ckeditor5-ui/src/notification/notification';export default class R extends _0x98924b{static get['requires'](){return[_0x1c888f,_0x1520dc];}static get[_0x3a63('0x1a')](){return'WebSocketGateway';}[_0x3a63('0x9')](){const _0x113c40=this[_0x3a63('0x21')],_0x56e718=_0x113c40['plugins']['get'](_0x1c888f),_0x5355e2=_0x113c40[_0x3a63('0x14')][_0x3a63('0x13')](_0x1520dc);if(!_0x56e718['token'])throw new _0x128779(_0x3a63('0x4'),this);if(!_0x56e718[_0x3a63('0x1f')])throw new _0x128779(_0x3a63('0xc'),this);return this['set'](_0x3a63('0x6'),'connecting'),this[_0x3a63('0x2')](_0x3a63('0x17'),!0x1),this['$']=new Set(),this['ee']=!0x1,this['te']=Object[_0x3a63('0x18')](_0x2da1a6),this['te'][_0x3a63('0x27')](window,_0x3a63('0x10'),()=>this[_0x3a63('0x17')]=!0x0),this['te'][_0x3a63('0x27')](window,_0x3a63('0x5'),()=>this[_0x3a63('0x17')]=!0x1),R[_0x3a63('0x16')][_0x3a63('0x1b')](_0x56e718[_0x3a63('0x0')],_0x56e718[_0x3a63('0x1f')],{'disconnectOnUnload':!0x1})['catch'](async _0x511fe7=>(console[_0x3a63('0x15')](_0x511fe7),console[_0x3a63('0x1d')](_0x3a63('0xd')),await Z(R[_0x3a63('0x1c')]),R[_0x3a63('0x16')][_0x3a63('0x1b')](_0x56e718['token'],_0x56e718['webSocketUrl'],{'disconnectOnUnload':!0x1})))[_0x3a63('0x2a')](async _0x1be1de=>(console[_0x3a63('0x15')](_0x1be1de),console[_0x3a63('0x1d')](_0x3a63('0xd')),await Z(R[_0x3a63('0x1c')]),R[_0x3a63('0x16')][_0x3a63('0x1b')](_0x56e718[_0x3a63('0x0')],_0x56e718[_0x3a63('0x1f')],{'disconnectOnUnload':!0x1})))['then'](_0x19d508=>{if(this[_0x3a63('0x12')]=_0x19d508,this['bind'](_0x3a63('0x6'))['to'](_0x19d508,_0x3a63('0x6'),this,'_isBrowserOffline',(_0x24c606,_0x127a1a)=>('connected'!==_0x24c606&&(this['ee']=!0x0),_0x127a1a||_0x3a63('0x29')!==_0x24c606?_0x3a63('0xf'):_0x3a63('0xf')==this[_0x3a63('0x6')]&&this['ee']?(this['ee']=!0x1,this['ie'](),'connecting'):_0x3a63('0x29'))),this[_0x3a63('0x12')]['on'](_0x3a63('0x15'),(_0x34d1ed,_0x10eda4)=>{if('limitExceeded'!==_0x10eda4['code'])throw console[_0x3a63('0x15')](_0x10eda4),new _0x128779('cloudservices-init:\x20Internal\x20WebSocketGateway\x20error',null);_0x5355e2['showWarning'](_0x3a63('0xb'),{'title':_0x3a63('0x23'),'namespace':_0x3a63('0x19')});}),!_0x19d508['me'])return new Promise(_0x8e178f=>_0x19d508['on'](_0x3a63('0x28'),_0x8e178f));})['catch'](_0x31522f=>{throw console[_0x3a63('0x15')](_0x31522f),new _0x128779(_0x3a63('0x26'),null);});}[_0x3a63('0x8')](_0x16827b){if(_0x3a63('0xa')!=typeof _0x16827b['reconnect'])throw new _0x128779('websocketgateway-invalid-plugin-interface:\x20Cannot\x20add\x20plugin\x20with\x20no\x20`reconnect()`\x20method.',this);if(this[_0x3a63('0x3')](_0x16827b))throw new _0x128779(_0x3a63('0xe'),this);this['$'][_0x3a63('0x1e')](_0x16827b);}['removeFromReconnectionStack'](_0x29ee5c){this['$'][_0x3a63('0x22')](_0x29ee5c);}[_0x3a63('0x3')](_0x4977bd){return this['$'][_0x3a63('0x25')](_0x4977bd);}['ie'](){return this[_0x3a63('0x12')][_0x3a63('0x11')]()['then'](()=>Promise[_0x3a63('0x20')](Array[_0x3a63('0x7')](this['$'],_0x5c12de=>_0x5c12de[_0x3a63('0x11')]())))['then'](()=>this[_0x3a63('0x6')]='connected')[_0x3a63('0x2a')](_0x370157=>{throw console[_0x3a63('0x15')](_0x370157),new _0x128779('cloudservices-reconnection-error:\x20An\x20internal\x20Cloud\x20Services\x20error\x20occurred\x20during\x20the\x20reconnection',this[_0x3a63('0x21')]);});}[_0x3a63('0x24')](){this['connection']&&this[_0x3a63('0x12')][_0x3a63('0x1')](),this['state']='disconnected',this['te']['stopListening'](),super[_0x3a63('0x24')]();}}function Z(_0x145e5a){return new Promise(_0x328d67=>setTimeout(_0x328d67,_0x145e5a));}R['WebSocketGateway']=_0x1b4fbf,R[_0x3a63('0x1c')]=0x3e8;