/*
 *             Copyright (c) 2016 - 2020, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import _0x223e7f from'@ckeditor/ckeditor5-core/src/plugin';import ft from'@ckeditor/ckeditor5-core/src/pendingactions';import lt from'@ckeditor/ckeditor5-collaboration-core/src/users';import kt from'@ckeditor/ckeditor5-engine/src/model/range';import _0x4b46d3 from'@ckeditor/ckeditor5-engine/src/model/liverange';import yt from'@ckeditor/ckeditor5-engine/src/model/documentselection';import wt from'@ckeditor/ckeditor5-engine/src/model/treewalker';import _0x287dee from'@ckeditor/ckeditor5-utils/src/ckeditorerror';import St from'@ckeditor/ckeditor5-comments/src/comments/commentsrepository';import _0x4be3ed from'./commands/trackchangescommand';import _0x46a155 from'./commands/acceptsuggestioncommand';import _0x182252 from'./commands/discardsuggestioncommand';import _0x3ff9c5 from'./commands/acceptallsuggestionscommand';import _0x161fcc from'./commands/acceptselectedsuggestionscommand';import _0x1bf6c7 from'./commands/discardallsuggestionscommand';import _0x37aa48 from'./commands/discardselectedsuggestionscommand';import ot from'./suggestion';import _0x25ed70 from'./suggestiondescriptionfactory';import ht from'@ckeditor/ckeditor5-utils/src/uid';import It from'@ckeditor/ckeditor5-utils/src/emittermixin';import nt from'@ckeditor/ckeditor5-utils/src/mix';import'../theme/suggestion.css';import'../theme/suggestionmarker.css';import _0x5cf49a from'./integrations/inputcommand';import _0x319154 from'./integrations/deletecommand';import _0x844f21 from'./integrations/entercommand';import _0x243489 from'./integrations/shiftentercommand';import it from'./integrations/undo';import _0xb2dcf8 from'./integrations/comments';import _0x552003 from'./integrations/image';import _0x56e7ec from'./integrations/horizontalline';import _0x179c49 from'./integrations/table';import _0x149681 from'./integrations/mediaembed';import _0x4025f4 from'./integrations/basicstyles';import _0x2c3787 from'./integrations/heading';import et from'./integrations/title';import _0x50debc from'./integrations/link';import _0x518544 from'./integrations/pagebreak';import _0x438657 from'./integrations/paragraph';import _0x308224 from'./integrations/blockquote';import _0x3b8825 from'./integrations/list';import _0x1066a4 from'./integrations/font';import _0x480e4d from'./integrations/removeformat';import _0x9472d2 from'./integrations/alignment';import _0x32d5c2 from'./integrations/highlight';import _0x306596 from'./integrations/mention';import _0x25e817 from'./integrations/indent';import _0x18cf6a from'./integrations/codeblock';import tt from'./integrations/standardeditingmode';import _0xedcd6b from'./integrations/restrictededitingmode';import _0x310ceb from'./integrations/selectall';import bt from'./utils/hashobject.js';export default class gt extends _0x223e7f{static get['requires'](){return[lt,ft,St,_0x5cf49a,_0x319154,_0x844f21,_0x243489,it,_0xb2dcf8,_0x552003,_0x56e7ec,_0x179c49,_0x149681,_0x4025f4,_0x2c3787,et,_0x50debc,_0x518544,_0x438657,_0x308224,_0x3b8825,_0x1066a4,_0x480e4d,_0x9472d2,_0x32d5c2,_0x306596,_0x25e817,_0x18cf6a,tt,_0xedcd6b,_0x310ceb];}static get['pluginName'](){return'TrackChangesEditing';}constructor(_0x1f95b3){function _0xc2c5cf(_0x18f5d6){return _0x18f5d6['map'](_0x112bc0=>String['fromCharCode'](_0x112bc0))['join']('');}super(_0x1f95b3),this['set']('activeMarkers',[]),this['on']('change:activeMarkers',(_0x55f8c9,_0xe46d3b,_0x5535c2,_0x3c62aa)=>{this['_model']['change'](_0x5304aa=>{for(const _0x2dc9f9 of[..._0x3c62aa,..._0x5535c2])this['_model']['markers']['has'](_0x2dc9f9)&&_0x5304aa['updateMarker'](_0x2dc9f9);});}),this['D']=null,this['_descriptionFactory']=new _0x25ed70(this['editor']['model']['schema'],this['editor']['locale']),this['_suggestionFactory']=new vt(this['editor']),this['_suggestions']=new Map(),this['_']=_0x1f95b3['plugins']['get'](St),this['h']=new Set(),this['_model']=this['editor']['model'],this['B']=new WeakMap(),this[_0xc2c5cf([0x5f,0x65,0x78,0x65,0x63,0x75,0x74,0x65,0x53,0x75,0x67,0x67,0x65,0x73,0x74,0x69,0x6f,0x6e])]=_0xc2c5cf([0x34,0x30,0x34,0x30,0x30,0x38,0x36,0x30]);}['init'](){const _0x43862a=this['editor'];_0x43862a['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'suggestion','view':_0x1b2777=>{const {id:_0x41b20d,type:_0x5a754b}=this['_splitMarkerName'](_0x1b2777['markerName']),_0x4842d9=['ck-suggestion-marker','ck-suggestion-marker-'+_0x5a754b];return this['activeMarkers']['includes'](_0x1b2777['markerName'])&&_0x4842d9['push']('ck-suggestion-marker--active'),{'classes':_0x4842d9,'attributes':{'data-suggestion':_0x41b20d},'priority':0xbb8};}}),_0x43862a['conversion']['for']('dataDowncast')['markerToElement']({'model':'suggestion','view':(_0x52853c,_0x3aae3b)=>{const {id:_0x240816,type:_0x3fce13,subType:_0x43b1e6,authorId:_0x3f39e0,markerCount:_0x413bdd}=this['_splitMarkerName'](_0x52853c['markerName']);return _0x3aae3b['createUIElement']('suggestion',{'id':_0x240816+':'+_0x3f39e0,'suggestion-type':_0x43b1e6?_0x3fce13+':'+_0x43b1e6:_0x3fce13,'type':_0x52853c['isOpening']?'start':'end','marker-count':_0x413bdd});}}),_0x43862a['conversion']['for']('upcast')['elementToMarker']({'view':{'name':'suggestion','attribute':{'id':/^\w/,'suggestionType':/^\w/}},'model':_0x282bb5=>{let _0x48e8bf='suggestion:'+_0x282bb5['getAttribute']('suggestion-type')+':'+_0x282bb5['getAttribute']('id');return _0x282bb5['getAttribute']('marker-count')&&(_0x48e8bf+=':'+_0x282bb5['getAttribute']('marker-count')),_0x48e8bf;}}),_0x43862a['conversion']['for']('editingDowncast')['add'](_0x55a857=>{_0x55a857['on']('addMarker:suggestion:formatBlock',(_0x1f746e,_0x54ea53,_0x786c5c)=>{if(_0x786c5c['consumable']['consume'](_0x54ea53['item'],_0x1f746e['name']))return;if(!_0x786c5c['consumable']['consume'](_0x54ea53['markerRange'],_0x1f746e['name']))return;const _0x248512=_0x54ea53['markerRange']['getWalker'](),_0x482327=_0x43862a['model']['schema'];for(const _0x672b11 of _0x248512){const _0x37b0ea=_0x672b11['item'],{id:_0x2a9aaf}=this['_splitMarkerName'](_0x54ea53['markerName']);if(_0x37b0ea['is']('element')&&_0x482327['isBlock'](_0x37b0ea)){const _0x45b7db=_0x786c5c['mapper']['toViewElement'](_0x37b0ea);_0x786c5c['writer']['addClass'](['ck-suggestion-marker','ck-suggestion-marker-formatBlock'],_0x45b7db),_0x786c5c['writer']['setAttribute']('data-suggestion',_0x2a9aaf,_0x45b7db),_0x786c5c['mapper']['bindElementToMarker'](_0x45b7db,_0x54ea53['markerName']),this['activeMarkers']['includes'](_0x54ea53['markerName'])?_0x786c5c['writer']['addClass']('ck-suggestion-marker--active',_0x45b7db):_0x786c5c['writer']['removeClass']('ck-suggestion-marker--active',_0x45b7db);}'elementStart'==_0x672b11['type']&&_0x482327['isObject'](_0x37b0ea)&&_0x248512['skip'](_0x318d6d=>!('elementEnd'==_0x318d6d['type']&&_0x318d6d['item']==_0x37b0ea));}},{'priority':'high'}),_0x55a857['on']('removeMarker:suggestion:formatBlock',(_0x7c0e5c,_0x26d852,_0x53c54d)=>{const _0x2cd43f=_0x53c54d['mapper']['markerNameToElements'](_0x26d852['markerName']);if(_0x2cd43f)for(const _0x31da65 of _0x2cd43f)_0x53c54d['writer']['removeClass']('ck-suggestion-marker-formatBlock',_0x31da65),_0x53c54d['writer']['removeClass']('ck-suggestion-marker--active',_0x31da65),_0x53c54d['writer']['removeAttribute']('data-suggestion',_0x31da65),_0x53c54d['mapper']['unbindElementFromMarkerName'](_0x31da65,_0x26d852['markerName']);},{'priority':'high'});}),_0x43862a['model']['document']['registerPostFixer'](_0x9db236=>{let _0x818a02=!0x1;const _0x3f8a4c=Array['from'](_0x43862a['model']['document']['differ']['getChangedMarkers']());for(const {name:_0x4d8f9b,data:_0x9a8bd3}of _0x3f8a4c){const {group:_0x2d186a,type:_0x224e00,id:_0x157df0}=this['_splitMarkerName'](_0x4d8f9b);if('suggestion'!==_0x2d186a)continue;const _0x9a9fea=this['_suggestions']['get'](_0x157df0);if(null!=_0x9a8bd3['newRange']){if('formatInline'==_0x224e00&&(_0x818a02=_0x818a02||Ct(_0x9a8bd3['newRange'],_0x4d8f9b,_0x9db236,_0x43862a['model']['schema'])),_0x9a8bd3['newRange']['isCollapsed']||'$graveyard'==_0x9a8bd3['newRange']['root']['rootName']||'formatBlock'==_0x224e00&&!At(_0x9a8bd3['newRange']))_0x9db236['removeMarker'](_0x4d8f9b),_0x818a02=!0x0;else{if(!_0x9a9fea||!_0x9a9fea['isInContent'])continue;_0x818a02=!!this['j'](_0x9a9fea)||_0x818a02;}}}return _0x818a02;}),_0x43862a['model']['document']['registerPostFixer'](_0x5b85c9=>{let _0x3cc356=!0x1;for(const _0x4a059e of _0x43862a['model']['document']['differ']['getChanges']()){if('insert'!=_0x4a059e['type'])continue;const _0x425fc6=_0x4a059e['position']['getShiftedBy'](_0x4a059e['length']);if(_0x425fc6['isAtEnd'])for(const _0xe9c5fe of this['_suggestions']['values']()){if(_0xe9c5fe['isMultiRange']||!_0xe9c5fe['isInContent'])continue;if('formatBlock'!=_0xe9c5fe['type'])continue;const _0x15694f=_0xe9c5fe['getFirstRange']();if(_0x15694f['start']['parent']!=_0x15694f['end']['parent']&&_0x15694f['end']['isEqual'](_0x4a059e['position'])){const _0x3f832b=_0x43862a['model']['createRange'](_0x15694f['start'],_0x425fc6);_0x5b85c9['updateMarker'](_0xe9c5fe['getFirstMarker'](),{'range':_0x3f832b}),_0x3cc356=!0x0;}}}return _0x3cc356;}),_0x43862a['model']['markers']['on']('update:suggestion',(_0x36c445,_0xccfe37,_0x374a0e)=>{if(null==_0x374a0e){const {id:_0x4acb3c}=this['_splitMarkerName'](_0xccfe37['name']),_0x1445bf=this['_suggestions']['get'](_0x4acb3c);_0x1445bf&&_0x1445bf['addMarkerName'](_0xccfe37['name']);}}),_0x43862a['model']['document']['on']('change:data',()=>{const _0x397d14=Array['from'](_0x43862a['model']['document']['differ']['getChangedMarkers']());_0x397d14['sort']((_0x503359,_0x4faa00)=>{const _0x29fde9=_0x503359['data']['oldRange'],_0xc94ec9=_0x4faa00['data']['oldRange'];return null===_0x29fde9&&null===_0xc94ec9?0x0:null===_0x29fde9&&null!==_0xc94ec9?-0x1:null!==_0x29fde9&&null===_0xc94ec9?0x1:_0x29fde9['start']['isBefore'](_0xc94ec9['start'])?-0x1:0x1;});for(const {name:_0x24cfbd,data:_0x2cf5de}of _0x397d14){const {group:_0x1ea6a5,id:_0x367286}=this['_splitMarkerName'](_0x24cfbd);if('suggestion'===_0x1ea6a5&&(null===_0x2cf5de['oldRange']&&this['M'](_0x24cfbd),null===_0x2cf5de['newRange'])){const _0x598ec6=this['_suggestions']['get'](_0x367286);_0x598ec6['isInContent']||this['U'](_0x598ec6);}}const _0x2c1e6f=new Set();for(const {name:_0xf9164c,data:_0x396d22}of _0x397d14){const {group:_0x3127f8,id:_0x13eb49}=this['_splitMarkerName'](_0xf9164c);if('suggestion'!==_0x3127f8)continue;const _0x4681dd=this['_suggestions']['get'](_0x13eb49);null!=_0x396d22['newRange']&&null!=_0x396d22['oldRange']&&(this['N'](_0x4681dd),_0x2c1e6f['add'](_0x4681dd['head']));}for(const _0x33fa40 of _0x2c1e6f)this['fire']('suggestionChanged',_0x33fa40);_0x2c1e6f['clear']();}),_0x43862a['model']['on']('applyOperation',(_0x297cc6,_0x519a1b)=>{const _0x51fd14=_0x519a1b[0x0];if(!this['_suggestions']['size'])return;if(!_0x51fd14['isDocumentOperation'])return;if('transparent'==_0x51fd14['batch']['type'])return;let _0x5e1e6f,_0x49b842;switch(_0x51fd14['type']){case'insert':_0x5e1e6f=_0x43862a['model']['createPositionAt'](_0x51fd14['position']),_0x49b842=_0x5e1e6f['getShiftedBy'](_0x51fd14['howMany']);break;case'split':_0x5e1e6f=_0x43862a['model']['createPositionAt'](_0x51fd14['splitPosition']),_0x49b842=_0x43862a['model']['createPositionAt'](_0x51fd14['moveTargetPosition']);break;case'move':_0x5e1e6f=_0x43862a['model']['createPositionAt'](_0x51fd14['targetPosition']),_0x49b842=_0x5e1e6f['getShiftedBy'](_0x51fd14['howMany']);break;default:return;}const _0x590518=_0x43862a['model']['createRange'](_0x5e1e6f,_0x49b842);_0x43862a['model']['change'](()=>{for(const {suggestion:_0x242a51,meta:_0x54468a}of this['R'](_0x590518)){if(_0x242a51['isMultiRange'])continue;if('formatInline'==_0x242a51['type'])continue;const _0x1c1532=_0x242a51['data']&&_0x242a51['data']['multipleBlocks'];('formatBlock'!=_0x242a51['type']||'split'==_0x51fd14['type']&&!_0x1c1532)&&(_0x54468a['containsRangeInObject']||'insertion'==_0x242a51['type']&&_0x54468a['isOwn']||_0x242a51['getFirstRange']()['containsRange'](_0x590518)&&this['O'](_0x242a51,_0x5e1e6f,_0x49b842));}});},{'priority':'lowest'}),_0x43862a['model']['on']('deleteContent',(_0x3c84db,_0x412305)=>{const _0x297d92=_0x412305[0x0],_0x903d96=_0x412305[0x1];if(_0x903d96&&_0x903d96['forceDefaultExecution'])return;if(!this['trackChangesCommand']['value'])return;if(_0x297d92['isCollapsed'])return;const _0x2693ea=_0x297d92['getFirstRange']();_0x43862a['model']['change'](_0x4e2c7b=>{this['markDeletion'](_0x2693ea);const _0x2205b9=_0x43862a['model']['schema']['getNearestSelectionRange'](_0x2693ea['start']);_0x297d92 instanceof yt?_0x4e2c7b['setSelection'](_0x2205b9):_0x297d92['setTo'](_0x2205b9);}),_0x3c84db['stop']();},{'priority':'high'}),_0x43862a['model']['on']('insertContent',(_0xb290c5,_0x3e8e5d)=>{const _0x2075d4=_0x3e8e5d[_0x3e8e5d['length']-0x1];_0x2075d4&&_0x2075d4['forceDefaultExecution']||this['trackChangesCommand']['value']&&(_0x43862a['model']['change'](()=>{let _0x487688=_0x43862a['model']['insertContent'](_0x3e8e5d[0x0],_0x3e8e5d[0x1],_0x3e8e5d[0x2],_0x3e8e5d[0x3],{'forceDefaultExecution':!0x0});_0xb290c5['return']=_0x487688['clone']();const _0x1bd18d=_0x487688['end']['nodeBefore'],_0x4221bc=_0x43862a['model']['schema'];_0x1bd18d&&_0x4221bc['isBlock'](_0x1bd18d)&&!_0x4221bc['isObject'](_0x1bd18d)&&(_0x487688=_0x43862a['model']['createRange'](_0x487688['start'],_0x43862a['model']['createPositionAt'](_0x1bd18d,'end'))),this['markInsertion'](_0x487688);}),_0xb290c5['stop']());},{'priority':'high'}),this['trackChangesCommand']=new _0x4be3ed(_0x43862a,this['h']),this['editor']['commands']['add']('trackChanges',this['trackChangesCommand']),this['enableCommand']('trackChanges');const _0x2f6cd2=new _0x46a155(_0x43862a,this['_suggestions']);_0x43862a['commands']['add']('acceptSuggestion',_0x2f6cd2),this['enableCommand']('acceptSuggestion');const _0x38534a=new _0x182252(_0x43862a,this['_suggestions']);_0x43862a['commands']['add']('discardSuggestion',_0x38534a),this['enableCommand']('discardSuggestion'),_0x43862a['commands']['add']('acceptAllSuggestions',new _0x3ff9c5(_0x43862a,_0x2f6cd2,this['_suggestions'])),this['enableCommand']('acceptAllSuggestions'),_0x43862a['commands']['add']('discardAllSuggestions',new _0x1bf6c7(_0x43862a,_0x38534a,this['_suggestions'])),this['enableCommand']('discardAllSuggestions'),_0x43862a['commands']['add']('acceptSelectedSuggestions',new _0x161fcc(_0x43862a,_0x2f6cd2,this['_suggestions'])),this['enableCommand']('acceptSelectedSuggestions'),_0x43862a['commands']['add']('discardSelectedSuggestions',new _0x37aa48(_0x43862a,_0x38534a,this['_suggestions'])),this['enableCommand']('discardSelectedSuggestions');const _0x4570e5=_0x43862a['plugins']['get'](St);this['listenTo'](_0x4570e5,'addComment',(_0x56d371,{threadId:_0x325d9b})=>{const _0xafd66b=this['_suggestions']['get'](_0x325d9b);_0xafd66b&&_0xafd66b['commentThread']&&0x1===_0xafd66b['commentThread']['length']&&this['P'](_0x325d9b,{'hasComments':!0x0});},{'priority':'low'}),this['listenTo'](_0x4570e5,'removeComment',(_0x28cfce,{threadId:_0x447f35})=>{const _0xe3d8c4=this['_suggestions']['get'](_0x447f35);_0xe3d8c4&&_0xe3d8c4['commentThread']&&!_0xe3d8c4['commentThread']['length']&&this['P'](_0x447f35,{'hasComments':!0x1});},{'priority':'low'});}set['adapter'](_0x4ce529){if(this['D'])throw new _0x287dee('track-changes-adapter-already-set:\x20Cannot\x20set\x20an\x20adapter\x20more\x20than\x20once.',this);this['D']=_0x4ce529;}get['adapter'](){return this['D'];}['getSuggestions'](){return Array['from'](this['_suggestions']['values']());}['getSuggestion'](_0x3423a1){const _0x439a2f=this['_suggestions']['get'](_0x3423a1);if(!_0x439a2f)throw new _0x287dee('track-changes-suggestion-not-found:\x20Suggestion\x20with\x20given\x20id\x20not\x20found.',this);return _0x439a2f;}['hasSuggestion'](_0x88cff4){return this['_suggestions']['has'](_0x88cff4);}['addSuggestionData'](_0x23e2b3){const {id:_0x11e84f,authorId:_0x270b6d}=_0x23e2b3,[_0x1c9272,_0x4110d9]=_0x23e2b3['type']['split'](':'),_0xe4217d=this['_suggestions']['get'](_0x11e84f)||this['G'](_0x1c9272,_0x4110d9,_0x11e84f,_0x270b6d);switch(this['F'](_0xe4217d),this['L'](_0xe4217d,_0x1c9272,_0x4110d9||null,_0x270b6d),_0xe4217d['createdAt']=_0x23e2b3['createdAt'],_0x23e2b3['data']&&(_0xe4217d['data']=_0x23e2b3['data']),this['B']['get'](_0xe4217d)){case'notReady':this['B']['set'](_0xe4217d,'dataReady');break;case'markerReady':_0xe4217d['isInContent']?(this['B']['set'](_0xe4217d,'ready'),this['fire']('suggestionLoaded',_0xe4217d)):this['B']['set'](_0xe4217d,'removed');}return _0xe4217d;}['enableCommand'](_0x521692,_0x583e34){const _0x5725f5=this['editor']['commands']['get'](_0x521692);if(!_0x5725f5)throw new _0x287dee('track-changes-command-not-found:\x20Trying\x20to\x20enable\x20command\x20that\x20does\x20not\x20exist.',this);this['h']['add'](_0x5725f5),_0x583e34&&_0x5725f5['on']('execute',(_0x452c14,_0x37d320)=>{this['trackChangesCommand']['value']&&(_0x37d320['length']>0x0&&_0x37d320[_0x37d320['length']-0x1]&&_0x37d320[_0x37d320['length']-0x1]['forceDefaultExecution']||(_0x583e34((..._0x618de0)=>_0x5725f5['execute'](..._0x618de0,{'forceDefaultExecution':!0x0}),..._0x37d320),_0x452c14['stop']()));},{'priority':'high'});}['markInsertion'](_0x287c8d,_0x336e24=null){if(_0x287c8d['isCollapsed'])return null;const _0x315dbd=this['editor']['plugins']['get']('Users')['me'];for(const {suggestion:_0x3e2f16,meta:_0xa1fd4c}of this['R'](_0x287c8d,'insertion'))if(_0xa1fd4c['isOwn']){if(_0xa1fd4c['isNextTo']&&_0x336e24==_0x3e2f16['subType']){const _0x573993=_0x3e2f16['getFirstRange']();_0x573993['start']['isEqual'](_0x287c8d['end'])?this['q'](_0x3e2f16,this['_model']['createRange'](_0x287c8d['start'],_0x573993['end'])):this['q'](_0x3e2f16,this['_model']['createRange'](_0x573993['start'],_0x287c8d['end']));}return _0x3e2f16;}const _0x18aac8=ht(),_0x44f741=_0x315dbd['id'],_0x22aaa0=_0x336e24?'insertion:'+_0x336e24:'insertion',_0x29864d=this['W']({'id':_0x18aac8,'type':_0x22aaa0,'createdAt':new Date(),'authorId':_0x44f741});return this['H'](_0x22aaa0,_0x18aac8,_0x44f741,_0x287c8d),_0x29864d;}['markMultiRangeInsertion'](_0xe0d8dc,_0x58bd56='multi'){const _0x2ef7ef=this['editor']['plugins']['get']('Users')['me'],_0x2e90a5=this['_suggestionFactory']['getSuggestionCallback']('insertion',_0x58bd56,'join');for(const _0x585ab2 of this['getSuggestions']())if(_0x585ab2['author']['id']==_0x2ef7ef['id']&&'insertion'==_0x585ab2['type']&&_0x585ab2['subType']==_0x58bd56&&(_0x2e90a5(_0x585ab2['getRanges'](),_0xe0d8dc)||_0x2e90a5(_0xe0d8dc,_0x585ab2['getRanges']()))){for(const _0x46131e of _0xe0d8dc)_0x585ab2['addRange'](_0x46131e);return _0x585ab2;}for(const _0x8b1a01 of _0xe0d8dc)for(const {suggestion:_0x292421,meta:_0x1e9ddf}of this['R'](_0x8b1a01,'insertion')){if(!_0x1e9ddf['isOwn'])continue;let _0x2181a6=!0x0;for(const _0x1303c7 of _0x292421['getRanges']())for(const _0x3ab471 of _0xe0d8dc)if(!_0x1303c7['containsRange'](_0x3ab471)){_0x2181a6=!0x1;break;}if(_0x2181a6)return _0x292421;}const _0xc72e20=ht(),_0x26113a=_0x2ef7ef['id'],_0x470919='insertion:'+_0x58bd56,_0x28d502=this['W']({'id':_0xc72e20,'type':_0x470919,'createdAt':new Date(),'authorId':_0x26113a});for(const _0x56c956 of _0xe0d8dc)this['H'](_0x470919,_0xc72e20,_0x26113a,_0x56c956,ot['getMultiRangeId']());return _0x28d502;}['markInlineFormat'](_0x14f1b4,_0x19bc68,_0x53b918=null){if(_0x53b918=_0x53b918||_t(_0x19bc68),_0x14f1b4['isCollapsed'])return;const _0x5af1cd=this['editor']['plugins']['get']('Users')['me'],_0x2ba5a2=[];for(const {suggestion:_0x51e257,meta:_0x38d99f}of this['R'](_0x14f1b4,'insertion'))!_0x38d99f['isOwn']||_0x38d99f['isNextTo']||_0x38d99f['isInsideObject']||_0x2ba5a2['push'](..._0x51e257['getRanges']());const _0x38784f=function(_0x590037,_0x2246f2){const _0xfe1109=[];for(const _0x20de93 of _0x2246f2){const _0x522a5a=_0x590037['getIntersection'](_0x20de93);_0xfe1109['push'](_0x522a5a);}return _0xfe1109;}(_0x14f1b4,_0x2ba5a2),_0x2cd047=function(_0x15ac81,_0x58a550){const _0x18be69=[_0x15ac81];for(const _0x30008d of _0x58a550){let _0x16e0ff=0x0;for(;_0x16e0ff<_0x18be69['length'];){const _0x2871c9=_0x18be69[_0x16e0ff]['getDifference'](_0x30008d);_0x18be69['splice'](_0x16e0ff,0x1,..._0x2871c9),_0x16e0ff+=_0x2871c9['length'];}}return _0x18be69;}(_0x14f1b4,_0x2ba5a2);_0x38784f['length']&&this['_model']['change'](()=>{for(const _0x4a4133 of _0x38784f){this['_suggestionFactory']['getSuggestionCallback']('formatInline',_0x53b918,'accept')([_0x4a4133],_0x19bc68);}});for(const _0x5b44b7 of _0x2cd047){let _0x3215a4=null,_0x14591e=_0x5b44b7['start'],_0x34bc55=_0x5b44b7['end'];for(const {suggestion:_0x4420,meta:_0x17cf86}of this['R'](_0x5b44b7,'formatInline')){if(!_0x17cf86['isOwn'])continue;if(_0x4420['subType']!=_0x53b918)continue;const _0x2d5ff4=_0x4420['getFirstRange']();if(_0x2d5ff4['containsRange'](_0x5b44b7,!0x0))return;_0x14591e=_0x14591e['isBefore'](_0x2d5ff4['start'])?_0x14591e:_0x2d5ff4['start'],_0x34bc55=_0x34bc55['isAfter'](_0x2d5ff4['end'])?_0x34bc55:_0x2d5ff4['end'],_0x3215a4?_0x2d5ff4['start']['isBefore'](_0x3215a4['getFirstRange']()['start'])?(_0x3215a4['removeMarkers'](),_0x3215a4=_0x4420):_0x4420['removeMarkers']():_0x3215a4=_0x4420;}const _0x567b75=this['_model']['createRange'](_0x14591e,_0x34bc55);if(_0x3215a4)this['q'](_0x3215a4,_0x567b75);else{const _0xa87acf=ht(),_0x489488=_0x5af1cd['id'];this['W']({'id':_0xa87acf,'type':'formatInline:'+_0x53b918,'data':_0x19bc68,'createdAt':new Date(),'authorId':_0x489488}),this['H']('formatInline:'+_0x53b918,_0xa87acf,_0x489488,_0x567b75);}}}['markBlockFormat'](_0xd540b0,_0x581948,_0x13d309=[],_0x4798b6=null){_0x581948['formatGroupId']||(_0x581948['formatGroupId']=_0x581948['commandName']),_0x581948['multipleBlocks']=_0xd540b0 instanceof kt,_0x4798b6=_0x4798b6||_t(_0x581948);const _0x5f0b80=_0x13d309['map'](_0x564f75=>Bt(_0x564f75,this['_model'])),_0x39eb2f=_0xd540b0 instanceof kt?_0xd540b0:Bt(_0xd540b0,this['_model']);_0x5f0b80['push'](_0x39eb2f);let _0x575e12=!0x0;for(const _0x3e11c3 of _0x5f0b80)if(!this['J'](_0x3e11c3)){_0x575e12=!0x1;break;}if(_0x575e12){return void this['_suggestionFactory']['getSuggestionCallback']('formatBlock',_0x4798b6,'accept')([_0x39eb2f],_0x581948);}let _0x3e0fd7=null,_0x48cfa7=_0x39eb2f['start'],_0x1cb84b=_0x39eb2f['end'];for(const {suggestion:_0x529d53,meta:_0x15927d}of this['R'](_0x39eb2f,'formatBlock')){if(!_0x15927d['isOwn']||_0x15927d['isNextTo']||_0x15927d['containsRangeInObject']||_0x15927d['isInsideObject'])continue;if(_0x529d53['data']['formatGroupId']!=_0x581948['formatGroupId'])continue;const _0x266a80=_0x529d53['getFirstRange']();if(_0x529d53['subType']==_0x4798b6){if(_0x266a80['containsRange'](_0x39eb2f,!0x0))return;_0x48cfa7=_0x48cfa7['isBefore'](_0x266a80['start'])?_0x48cfa7:_0x266a80['start'],_0x1cb84b=_0x1cb84b['isAfter'](_0x266a80['end'])?_0x1cb84b:_0x266a80['end'],_0x3e0fd7?_0x266a80['start']['isBefore'](_0x3e0fd7['getFirstRange']()['start'])?(_0x3e0fd7['removeMarkers'](),_0x3e0fd7=_0x529d53):_0x529d53['removeMarkers']():_0x3e0fd7=_0x529d53;}else{const _0x436560=_0x39eb2f['getIntersection'](_0x266a80);this['K'](_0x529d53,_0x436560);}}const _0x2ad736=this['editor']['plugins']['get']('Users')['me'],_0x94077d=ht(),_0x8cd044=_0x2ad736['id'];_0x3e0fd7?this['q'](_0x3e0fd7,this['_model']['createRange'](_0x48cfa7,_0x1cb84b)):(this['W']({'id':_0x94077d,'type':'formatBlock:'+_0x4798b6,'data':_0x581948,'createdAt':new Date(),'authorId':_0x8cd044}),this['H']('formatBlock:'+_0x4798b6,_0x94077d,_0x8cd044,this['_model']['createRange'](_0x48cfa7,_0x1cb84b)));}['markDeletion'](_0x3ff619,_0x33b74e=null){if(_0x3ff619['isCollapsed'])return null;const _0x4dc461=this['editor']['plugins']['get']('Users')['me'],_0x53798b=new _0x4b46d3(_0x3ff619['start'],_0x3ff619['end']);for(const {suggestion:_0x48626f,meta:_0x47fe9b}of this['R'](_0x53798b,'insertion'))if(_0x47fe9b['isOwn']&&!_0x47fe9b['isNextTo'])if(_0x48626f['isMultiRange']){const _0x3e6f31=_0x48626f['getRanges']();if(_0x3e6f31['every'](_0x1348e0=>_0x53798b['containsRange'](_0x1348e0,!0x0))&&_0x48626f['discard'](),_0x3e6f31['some'](_0x4dd0da=>_0x4dd0da['containsRange'](_0x53798b,!0x0))){return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x33b74e,'accept')([_0x53798b]),null;}}else{const _0x418038=_0x53798b['getIntersection'](_0x48626f['getFirstRange']());_0x48626f['_onDiscard']([_0x418038]);}if(_0x53798b['detach'](),_0x53798b['isCollapsed']||'$graveyard'==_0x53798b['root']['rootName'])return null;let _0x3cc2d4=null,_0x55db1a=_0x53798b['start'],_0x209dff=_0x53798b['end'];for(const {suggestion:_0xaf5a74,meta:_0x3886b1}of this['R'](_0x53798b,'deletion'))if(_0x3886b1['isOwn'])if(_0xaf5a74['isMultiRange']){let _0x3e4907=!0x0;for(const _0x1d5166 of _0xaf5a74['getRanges']()){if(_0x1d5166['containsRange'](_0x53798b,!0x0))return _0xaf5a74;_0x53798b['containsRange'](_0x1d5166)||(_0x3e4907=!0x1);}_0x3e4907&&_0xaf5a74['discard']();}else{const _0x1a26bf=_0xaf5a74['getFirstRange']();if(_0x1a26bf['containsRange'](_0x53798b,!0x0))return _0xaf5a74;_0x55db1a=_0x55db1a['isBefore'](_0x1a26bf['start'])?_0x55db1a:_0x1a26bf['start'],_0x209dff=_0x209dff['isAfter'](_0x1a26bf['end'])?_0x209dff:_0x1a26bf['end'],_0x3cc2d4?_0x1a26bf['start']['isBefore'](_0x3cc2d4['getFirstRange']()['start'])?(_0x3cc2d4['removeMarkers'](),_0x3cc2d4=_0xaf5a74):_0xaf5a74['removeMarkers']():_0x3cc2d4=_0xaf5a74;}if(_0x3cc2d4)return this['q'](_0x3cc2d4,this['_model']['createRange'](_0x55db1a,_0x209dff)),_0x3cc2d4;{const _0x1ece12=ht(),_0x58db68=this['_model']['createRange'](_0x55db1a,_0x209dff),_0x3fbc15=_0x4dc461['id'],_0x39ba80=_0x33b74e?'deletion:'+_0x33b74e:'deletion',_0x29e985=this['W']({'id':_0x1ece12,'type':_0x39ba80,'createdAt':new Date(),'authorId':_0x3fbc15});return this['H'](_0x39ba80,_0x1ece12,_0x3fbc15,_0x58db68),_0x29e985;}}['markMultiRangeDeletion'](_0x308c99,_0x3efc12='multi'){const _0x3db50c=this['editor']['plugins']['get']('Users')['me'],_0x58f619=_0x308c99['map'](_0x27e461=>new _0x4b46d3(_0x27e461['start'],_0x27e461['end'])),_0x206033=new Set();for(const _0x2a4e37 of _0x58f619)for(const {suggestion:_0x3a5fbc,meta:_0x2cbf3e}of this['R'](_0x2a4e37,'insertion'))_0x2cbf3e['isOwn']&&!_0x2cbf3e['isNextTo']&&_0x206033['add'](_0x3a5fbc);for(const _0x5b87f5 of _0x206033)if(_0x5b87f5['isMultiRange']){const _0x449aa0=_0x5b87f5['getRanges']();if(_0x449aa0['every'](_0x22afa0=>_0x58f619['some'](_0x199d15=>_0x199d15['containsRange'](_0x22afa0,!0x0)))&&_0x5b87f5['discard'](),_0x58f619['every'](_0x53170f=>_0x449aa0['some'](_0x4f6b07=>_0x4f6b07['containsRange'](_0x53170f,!0x0)))){return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x3efc12,'accept')(_0x308c99),null;}}else{const _0x13fab5=_0x5b87f5['getFirstRange']();if(_0x58f619['some'](_0x38a252=>_0x38a252['containsRange'](_0x13fab5,!0x0))&&_0x5b87f5['discard'](),_0x58f619['every'](_0x1f628c=>_0x13fab5['containsRange'](_0x1f628c,!0x0))){return this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x3efc12,'accept')(_0x58f619),null;}}const _0x3e3aba=this['_suggestionFactory']['getSuggestionCallback']('deletion',_0x3efc12,'join');let _0x736b23=null;for(const _0x3ec7bf of this['getSuggestions']())if(_0x3ec7bf['author']['id']==_0x3db50c['id']&&_0x3ec7bf['isInContent']&&'deletion'==_0x3ec7bf['type']&&_0x3ec7bf['subType']==_0x3efc12&&(_0x3e3aba(_0x3ec7bf['getRanges'](),_0x308c99)||_0x3e3aba(_0x308c99,_0x3ec7bf['getRanges']())))if(_0x736b23){if(_0x3ec7bf['commentThread']&&_0x3ec7bf['commentThread']['length'])continue;for(const _0x1d7abd of _0x3ec7bf['getRanges']())_0x736b23['addRange'](_0x1d7abd);_0x3ec7bf['removeMarkers']();}else{_0x736b23=_0x3ec7bf;for(const _0x19a44e of _0x308c99)_0x3ec7bf['addRange'](_0x19a44e);}if(_0x736b23)return _0x736b23;_0x206033['clear']();for(const _0x218d09 of _0x58f619)for(const {suggestion:_0x4387a3,meta:_0x49c3ad}of this['R'](_0x218d09,'deletion'))_0x49c3ad['isOwn']&&_0x206033['add'](_0x4387a3);for(const _0xb086f0 of _0x206033){const _0x1cf471=_0xb086f0['getRanges']();if(_0x58f619['every'](_0x1f0e3b=>_0x1cf471['some'](_0x18014d=>_0x18014d['containsRange'](_0x1f0e3b,!0x0))))return _0xb086f0;_0x1cf471['every'](_0x3864e6=>_0x58f619['some'](_0x5c7a19=>_0x5c7a19['containsRange'](_0x3864e6,!0x0)))&&_0xb086f0['discard']();}const _0x40e271=ht(),_0x38e797=_0x3db50c['id'],_0x17faf1='deletion:'+_0x3efc12,_0xfaa999=this['W']({'id':_0x40e271,'type':_0x17faf1,'createdAt':new Date(),'authorId':_0x38e797});for(const _0x258369 of _0x58f619)_0x258369['detach'](),_0x258369['isCollapsed']||'$graveyard'==_0x258369['root']['rootName']||this['H'](_0x17faf1,_0x40e271,_0x38e797,_0x258369,ot['getMultiRangeId']());return _0xfaa999;}['q'](_0x1e86bd,_0x3098aa){const _0x543d51=_0x1e86bd['getFirstMarker']();this['_model']['change'](_0x1ef5da=>{_0x1ef5da['updateMarker'](_0x543d51,{'range':_0x3098aa});});}['F'](_0x523fd1){const _0x67ade4=_0x523fd1['id'],_0x1c9e15=this['editor']['config']['get']('collaboration.channelId');this['_']['hasCommentThread'](_0x67ade4)||this['_']['addCommentThread']({'channelId':_0x1c9e15,'threadId':_0x67ade4}),_0x523fd1['commentThread']=this['_']['getCommentThread'](_0x67ade4);}['L'](_0x1efa5e,_0x59427d,_0x46667b,_0x30ea5e){if(_0x1efa5e['type']!=_0x59427d||_0x1efa5e['subType']!=_0x46667b||_0x1efa5e['author']['id']!=_0x30ea5e)throw this['editor']['isReadOnly']=!0x0,new _0x287dee('track-changes-suggestion-data-mismatch:\x20Suggestion\x20marker\x20name\x20does\x20not\x20match\x20loaded\x20suggestion\x20data.',this);}['K'](_0x18484b,_0x1a080f){const _0x59aebf=_0x18484b['getFirstRange']();if(_0x1a080f['isEqual'](_0x59aebf))_0x18484b['removeMarkers']();else if(_0x59aebf['containsRange'](_0x1a080f)){const _0x25a630=this['_model']['createPositionAt'](_0x1a080f['start']['nodeBefore'],'end');this['q'](_0x18484b,this['_model']['createRange'](_0x59aebf['start'],_0x25a630));const _0x2d2ec3=ht(),_0x434f39=_0x18484b['author']['id'],_0x466181=_0x18484b['type']+':'+_0x18484b['subType'];this['W']({'id':_0x2d2ec3,'type':_0x466181,'createdAt':new Date(),'authorId':_0x434f39,'data':_0x18484b['data']});const _0x3f0060=this['_model']['createPositionAt'](_0x1a080f['end']['parent'],'after'),_0x27600e=this['_model']['createRange'](_0x3f0060,_0x59aebf['end']);this['H'](_0x466181,_0x2d2ec3,_0x434f39,_0x27600e);}else if(_0x59aebf['containsPosition'](_0x1a080f['start'])){const _0x5868e6=this['_model']['createPositionAt'](_0x1a080f['start']['nodeBefore'],'end');this['q'](_0x18484b,this['_model']['createRange'](_0x59aebf['start'],_0x5868e6));}else{const _0x3f52b0=this['_model']['createPositionAt'](_0x1a080f['end']['parent'],'after');this['q'](_0x18484b,this['_model']['createRange'](_0x3f52b0,_0x59aebf['end']));}}['J'](_0x62c1c1){for(const {suggestion:_0x2df480,meta:_0x25ded4}of this['R'](_0x62c1c1,'insertion')){if(!_0x25ded4['isOwn'])continue;const _0x1eb152=_0x2df480['getRanges']();for(const _0x11f87a of _0x1eb152)if(!_0x62c1c1['getDifference'](_0x11f87a)['length'])return!0x0;}return!0x1;}['V'](_0x8a469b){const _0x23cdca=this['editor']['plugins']['get']('Users')['getUser'](_0x8a469b);if(!_0x23cdca)throw new _0x287dee('track-changes-user-not-found:\x20User\x20with\x20given\x20id\x20not\x20found.',this);return _0x23cdca;}['G'](_0xd7abd5,_0xd6282f,_0x1d293c,_0x11b86b){const _0x4c59c4=this['V'](_0x11b86b),_0x406411=this['_suggestionFactory']['buildSuggestion'](_0xd7abd5,_0xd6282f,_0x1d293c,_0x4c59c4);return this['listenTo'](_0x406411,'accept',()=>{this['P'](_0x1d293c,{'state':'accepted'});},{'priority':'high'}),this['listenTo'](_0x406411,'discard',()=>{this['P'](_0x1d293c,{'state':'rejected'});},{'priority':'high'}),this['_suggestions']['set'](_0x1d293c,_0x406411),this['B']['set'](_0x406411,'notReady'),_0x406411;}['_splitMarkerName'](_0x1a09c7){const _0x56c0d1=_0x1a09c7['split'](':');return{'group':_0x56c0d1[0x0],'type':_0x56c0d1[0x1],'subType':_0x56c0d1['length']>=0x5?_0x56c0d1[0x2]:null,'id':_0x56c0d1['length']<0x5?_0x56c0d1[0x2]:_0x56c0d1[0x3],'authorId':_0x56c0d1['length']<0x5?_0x56c0d1[0x3]:_0x56c0d1[0x4],'markerCount':0x6==_0x56c0d1['length']?_0x56c0d1[0x5]:null};}['O'](_0x288ea8,_0x1d142c,_0x14f988){const _0x22dc1f=_0x288ea8['getFirstRange'](),_0x40d537=_0x22dc1f['start'],_0x542fd1=_0x22dc1f['end'];this['q'](_0x288ea8,this['_model']['createRange'](_0x40d537,_0x1d142c));const _0x4b61c2=ht(),_0x27e7ba=_0x288ea8['author']['id'],_0x173a60=_0x288ea8['type']+(_0x288ea8['subType']?':'+_0x288ea8['subType']:'');this['W']({'id':_0x4b61c2,'type':_0x173a60,'createdAt':new Date(),'authorId':_0x27e7ba,'originalSuggestionId':_0x288ea8['id'],'data':_0x288ea8['data']}),'formatBlock'==_0x288ea8['type']&&(_0x14f988=this['_model']['createPositionBefore'](_0x14f988['parent'])),this['H'](_0x173a60,_0x4b61c2,_0x27e7ba,this['_model']['createRange'](_0x14f988,_0x542fd1));}['R'](_0x41520f,_0x4466f7=null){const _0x33a97a=[],_0x277bd0=this['_model']['schema'],_0x296623=this['editor']['plugins']['get']('Users')['me'];for(const _0x1b24e4 of this['getSuggestions']())if(_0x1b24e4['isInContent']&&(!_0x4466f7||_0x1b24e4['type']==_0x4466f7))for(const _0x19addc of _0x1b24e4['getRanges']()){const _0x1a2d54=_0x41520f['start']['isEqual'](_0x19addc['end'])||_0x41520f['end']['isEqual'](_0x19addc['start']);if(_0x1a2d54||_0x41520f['getIntersection'](_0x19addc)){const _0xf17f44=_0x41520f['containsRange'](_0x19addc)&&Dt(_0x277bd0,_0x19addc['start'],_0x41520f),_0x4c761c=_0x19addc['containsRange'](_0x41520f)&&Dt(_0x277bd0,_0x41520f['start'],_0x19addc);_0x33a97a['push']({'suggestion':_0x1b24e4,'meta':{'isOwn':_0x296623==_0x1b24e4['author'],'isNextTo':_0x1a2d54,'isInsideObject':_0xf17f44,'containsRangeInObject':_0x4c761c}});break;}}return _0x33a97a;}['H'](_0x2b96e4,_0xe042ff,_0x12a594,_0xf6c9b5,_0x307648=null){this['_model']['change'](_0x529d5c=>{let _0x404855='suggestion:'+_0x2b96e4+':'+_0xe042ff+':'+_0x12a594;_0x307648&&(_0x404855=_0x404855+':'+_0x307648),_0x529d5c['addMarker'](_0x404855,{'range':_0xf6c9b5,'usingOperation':!0x0,'affectsData':!0x0});});}['U'](_0x52743d){const _0x2c57a8=_0x52743d['previous'],_0x4d36bc=_0x52743d['next'];_0x52743d['previous']=null,null!=_0x2c57a8&&(_0x2c57a8['next']=null),_0x52743d['next']=null,'ready'==this['B']['get'](_0x52743d)&&(this['B']['set'](_0x52743d,'removed'),this['fire']('suggestionUnloaded',_0x52743d,_0x2c57a8,_0x4d36bc)),null!=_0x4d36bc&&(_0x4d36bc['previous']=null);}['W'](_0x302449){const _0x5cba89=_0x302449['id'],_0x46eb40=this['addSuggestionData'](_0x302449);if(this['D']&&this['D']['addSuggestion']){const _0x44ceba=this['editor']['plugins']['get']('PendingActions'),_0x1683bf=_0x46eb40['hasComments'],_0x56f3a3=_0x46eb40['subType']?_0x46eb40['type']+':'+_0x46eb40['subType']:_0x46eb40['type'],t=this['editor']['locale']['t'],_0x549502=_0x44ceba['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'})),_0x3b5d3b={'id':_0x5cba89,'type':_0x56f3a3,'hasComments':_0x1683bf,'data':_0x302449['data']||null,'originalSuggestionId':_0x302449['originalSuggestionId']||null};this['D']['addSuggestion'](_0x3b5d3b)['then'](_0x5c22e3=>{_0x44ceba['remove'](_0x549502),_0x5c22e3&&_0x5c22e3['createdAt']&&(this['_suggestions']['get'](_0x5cba89)['createdAt']=_0x5c22e3['createdAt']);});}return _0x46eb40;}['P'](_0x563422,_0x2e18f1){const _0x31d7d7=this['editor']['plugins']['get']('PendingActions');if(this['D']&&this['D']['updateSuggestion']){const t=this['editor']['locale']['t'],_0x3f066f=_0x31d7d7['add'](t({'string':'Unsaved\x20change\x20in\x20suggestion.','id':'PENDING_ACTION_SUGGESTION'}));this['D']['updateSuggestion'](_0x563422,_0x2e18f1)['then'](()=>{_0x31d7d7['remove'](_0x3f066f);});}}['X'](_0x301677){if(!this['D']||!this['D']['getSuggestion'])throw new _0x287dee('track-changes-adapter-missing-getsuggestion:\x20Adapter\x20not\x20set\x20or\x20is\x20missing\x20`getSuggestion()`\x20method.',this);return this['D']['getSuggestion'](_0x301677);}['M'](_0x2fe845){const {id:_0xdfe905,type:_0x54e6b7,subType:_0x4754f3,authorId:_0x8ab3c1}=this['_splitMarkerName'](_0x2fe845),_0x5721cb=this['_suggestions']['get'](_0xdfe905)||this['G'](_0x54e6b7,_0x4754f3,_0xdfe905,_0x8ab3c1);switch(this['L'](_0x5721cb,_0x54e6b7,_0x4754f3,_0x8ab3c1),this['B']['get'](_0x5721cb)){case'notReady':this['X'](_0xdfe905)['then'](_0x22af9b=>{let _0x203c9c=Promise['resolve']();_0x22af9b['hasComments']&&(_0x203c9c=this['_']['fetchCommentThread']({'channelId':this['editor']['config']['get']('collaboration.channelId'),'threadId':_0xdfe905})),_0x203c9c['then'](()=>{this['addSuggestionData'](_0x22af9b);});}),this['B']['set'](_0x5721cb,'markerReady');break;case'removed':this['P'](_0xdfe905,{'state':'open'});case'dataReady':this['B']['set'](_0x5721cb,'ready'),this['fire']('suggestionLoaded',_0x5721cb);break;case'ready':this['fire']('suggestionChanged',_0x5721cb);}_0x5721cb['addMarkerName'](_0x2fe845),this['N'](_0x5721cb);}['N'](_0x5e31b6){if('formatInline'==_0x5e31b6['type']||'formatBlock'==_0x5e31b6['type'])return;if(_0x5e31b6['isMultiRange'])return;let _0x52d551=!0x0;for(const _0x29cbee of this['getSuggestions']())if(!_0x29cbee['isMultiRange']&&_0x29cbee!=_0x5e31b6&&_0x29cbee['isInContent']&&'formatInline'!=_0x29cbee['type']&&'formatBlock'!=_0x29cbee['type']&&_0x29cbee['author']['id']==_0x5e31b6['author']['id']){if(this['Y'](_0x29cbee,_0x5e31b6)){if(_0x5e31b6['commentThread']&&_0x5e31b6['commentThread']['length'])continue;_0x29cbee['next']=_0x5e31b6,_0x5e31b6['previous']=_0x29cbee,_0x52d551=!0x1;}if(this['Y'](_0x5e31b6,_0x29cbee)){if(_0x29cbee['commentThread']&&_0x29cbee['commentThread']['length'])continue;_0x5e31b6['next']=_0x29cbee,_0x29cbee['previous']=_0x5e31b6;}}_0x5e31b6['previous']&&_0x52d551&&(_0x5e31b6['previous']['next']=null,_0x5e31b6['previous']=null);}['Y'](_0x445132,_0x5be557){const _0x16b890=_0x445132['getFirstRange'](),_0xdc9b6d=_0x5be557['getFirstRange']();if(_0x16b890['end']['isEqual'](_0xdc9b6d['start']))return!0x0;if(_0x445132['type']!=_0x5be557['type'])return!0x1;if(!_0x16b890['end']['isTouching'](_0xdc9b6d['start']))return!0x1;const _0x5cc989=new wt({'boundaries':this['editor']['model']['createRange'](_0x16b890['end'],_0xdc9b6d['start'])});for(const _0x5e639d of _0x5cc989)if('elementEnd'==_0x5e639d['type']&&this['editor']['model']['schema']['isLimit'](_0x5e639d['item']))return!0x1;return!0x0;}['j'](_0x4d3a5f){for(const _0x34aa32 of this['_suggestions']['values']()){if(_0x34aa32==_0x4d3a5f||!_0x34aa32['isInContent'])continue;if(_0x34aa32['type']!=_0x4d3a5f['type']||_0x34aa32['author']['id']!=_0x4d3a5f['author']['id']||_0x34aa32['subType']!=_0x4d3a5f['subType'])continue;const _0x3fda69=this['_suggestionFactory']['getSuggestionCallback'](_0x4d3a5f['type'],_0x4d3a5f['subType'],'join');if(_0x3fda69(_0x34aa32['getRanges'](),_0x4d3a5f['getRanges']())){if(_0x4d3a5f['commentThread']&&_0x4d3a5f['commentThread']['length'])continue;return this['Z'](_0x34aa32,_0x4d3a5f),!0x0;}if(_0x3fda69(_0x4d3a5f['getRanges'](),_0x34aa32['getRanges']())){if(_0x34aa32['commentThread']&&_0x34aa32['commentThread']['length'])continue;return this['Z'](_0x4d3a5f,_0x34aa32),!0x0;}}return!0x1;}['Z'](_0x1f39f7,_0xf964f2){if(_0x1f39f7['isMultiRange'])for(const _0x11cd67 of _0xf964f2['getRanges']())_0x1f39f7['addRange'](_0x11cd67);else{const _0x1cf1e9=_0xf964f2['getFirstRange']()['end'];this['q'](_0x1f39f7,this['_model']['createRange'](_0x1f39f7['getFirstRange']()['start'],_0x1cf1e9));}_0xf964f2['removeMarkers']();}}nt(gt,It);class vt{constructor(_0x2ec705){this['tt']=_0x2ec705,this['_model']=_0x2ec705['model'],this['$']=new Map(),this['it']=new Map(),this['et']();}['buildSuggestion'](_0x322119,_0x3e1aed,_0x160000,_0xc50319){return new ot(this['_model'],{'type':_0x322119,'subType':_0x3e1aed,'id':_0x160000,'author':_0xc50319,'onAccept':(..._0x12f3ed)=>this['getSuggestionCallback'](_0x322119,_0x3e1aed,'accept')(..._0x12f3ed),'onDiscard':(..._0xe0f36e)=>this['getSuggestionCallback'](_0x322119,_0x3e1aed,'discard')(..._0xe0f36e)});}['registerCustomCallback'](_0x410a8b,_0x20b095,_0x274eab,_0x334761){const _0x22430e=_0x410a8b+':'+_0x20b095+':'+_0x274eab;this['$']['set'](_0x22430e,_0x334761);}['getSuggestionCallback'](_0x356308,_0x3ddcb8,_0x59e024){const _0x1ca0e0=_0x356308+':'+_0x3ddcb8+':'+_0x59e024;return this['$']['get'](_0x1ca0e0)||this['it']['get'](_0x356308+':'+_0x59e024);}['et'](){const _0x64180f=()=>{},_0xbdb948=_0x1f0883=>{_0x1f0883['sort']((_0x105b1d,_0x5c0a80)=>_0x105b1d['start']['isBefore'](_0x5c0a80['start'])?0x1:-0x1),this['_model']['change'](_0x342fbb=>{for(const _0x49434c of _0x1f0883){const _0x10e1bd=_0x342fbb['createSelection'](_0x49434c);this['_model']['deleteContent'](_0x10e1bd,{'forceDefaultExecution':!0x0,'doNotAutoparagraph':!0x0});}});},_0x6393c5=(_0x4703ed,_0x24045b)=>{this['_model']['change'](_0x318fd7=>{const {commandName:_0x5d9fa0,commandParams:_0x5ccb8f}=_0x24045b,_0x5be526=_0x4703ed[0x0];if('$graveyard'==_0x5be526['root']['rootName'])return;const _0x2b0dea=_0x4b46d3['fromRange'](this['_model']['document']['selection']['getFirstRange']());var _0x22bdee;(_0x22bdee=_0x5be526)['end']['parent']==_0x22bdee['start']['nodeAfter']&&0x0==_0x22bdee['end']['offset']?_0x318fd7['setSelection'](this['_model']['createRange'](_0x5be526['end'])):_0x318fd7['setSelection'](_0x5be526),this['tt']['commands']['get'](_0x5d9fa0)['refresh'](),_0x5ccb8f['push']({'forceDefaultExecution':!0x0}),this['tt']['execute'](_0x5d9fa0,..._0x5ccb8f),'$graveyard'!=_0x2b0dea['root']['rootName']&&_0x318fd7['setSelection'](_0x2b0dea),_0x2b0dea['detach']();});},_0x30335f=(_0x57381a,_0x24ae60)=>0x1==_0x57381a['length']&&0x1==_0x24ae60['length']&&_0x57381a[0x0]['end']['isEqual'](_0x24ae60[0x0]['start']);this['it']['set']('insertion:accept',_0x64180f),this['it']['set']('insertion:discard',_0xbdb948),this['it']['set']('insertion:join',_0x30335f),this['it']['set']('deletion:accept',_0xbdb948),this['it']['set']('deletion:discard',_0x64180f),this['it']['set']('deletion:join',_0x30335f),this['it']['set']('formatInline:accept',_0x6393c5),this['it']['set']('formatInline:discard',_0x64180f),this['it']['set']('formatInline:join',_0x30335f),this['it']['set']('formatBlock:accept',_0x6393c5),this['it']['set']('formatBlock:discard',_0x64180f),this['it']['set']('formatBlock:join',_0x30335f);}}function Dt(_0x3b9432,_0x328338,_0x24e6f0){for(const _0xbc6d55 of _0x328338['parent']['getAncestors']({'includeSelf':!0x0,'parentFirst':!0x0})){if(_0xbc6d55['root']==_0xbc6d55)return!0x1;if(!_0x24e6f0['containsItem'](_0xbc6d55))return!0x1;if(_0x3b9432['isObject'](_0xbc6d55)||_0x3b9432['isLimit'](_0xbc6d55))return!0x0;}}function Ct(_0x573192,_0x1d9186,_0x4d3073,_0x4a2333){const _0x1beaed=_0x573192['start']['getLastMatchingPosition'](_0x1f995d=>!_0x1f995d['item']['is']('textProxy')&&!_0x4a2333['isObject'](_0x1f995d['item'])),_0x4609ff=_0x573192['end']['getLastMatchingPosition'](_0x1017f8=>!_0x1017f8['item']['is']('textProxy')&&!_0x4a2333['isObject'](_0x1017f8['item']),{'direction':'backward'});if(!_0x573192['start']['isEqual'](_0x1beaed)||!_0x573192['end']['isEqual'](_0x4609ff)){const _0x105ed2=_0x4d3073['createRange'](_0x1beaed,_0x4609ff);return _0x4d3073['updateMarker'](_0x1d9186,{'range':_0x105ed2}),!0x0;}return!0x1;}function _t(_0x9cb7b9){return bt(_0x9cb7b9);}function At(_0xc74533){const _0xe5cb44=_0xc74533['start']['nodeAfter'];return _0xe5cb44&&_0xe5cb44['is']('element');}function Bt(_0x2bf94a,_0x166ac3){return _0x166ac3['createRange'](_0x166ac3['createPositionAt'](_0x2bf94a,'before'),_0x166ac3['schema']['isObject'](_0x2bf94a)?_0x166ac3['createPositionAfter'](_0x2bf94a):_0x166ac3['createPositionAt'](_0x2bf94a,'end'));}